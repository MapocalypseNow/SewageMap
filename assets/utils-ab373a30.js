import{D as l,E as p,F as x,dS as It,dR as re,P as T,X as Bt,v as j,fJ as tt,an as k,is as oe,eF as ft,it as ie,fs as at,a1 as ae,V as Ot,bi as Mt,w as ue}from"./vendor-128d427e.js";import{o as le,c as ce,a as pe,x as ht,u as he,d as fe}from"./RasterSymbolizer-bb89ee1c.js";import{r as me,g,h as de,o as Gt,i as Lt,k as ge,y as ye,w as xe,c as Vt,x as we}from"./pixelUtils-f34c729f.js";let ut=class extends It{constructor(){super(...arguments),this.raster=void 0}};l([p({json:{write:!0}})],ut.prototype,"raster",void 0),ut=l([x("esri.layers.support.rasterFunctions.AspectFunctionArguments")],ut);const R=ut;var mt;let dt=mt=class extends R{clone(){return new mt({raster:this.raster})}};dt=mt=l([x("esri.layers.support.rasterFunctions.AspectFunctionArguments")],dt);const Ae=dt;let B=class extends It{constructor(){super(...arguments),this.functionArguments=null,this.readingBufferSize=0}bind(n,i=!1){const a=this._getRasterValues();for(let o=0;o<a.length;o++){const s=a[o];if(s&&typeof s=="object"&&"bind"in s&&(!s.rasterInfo||i)){const r=s.bind(n,i);if(!r.success)return r}}return!this.rasterInfo||i?(this.sourceRasterInfos=this._getSourceRasterInfos(n),this._bindSourceRasters()):{success:!0}}process(n){const i=this._getRasterValues().map(a=>this._readRasterValue(a,n));return this._processPixels({...n,pixelBlocks:i})}getPrimaryRasters(){const n=[],i=[];return this._getPrimaryRasters(this,n,i),{rasters:n,rasterIds:i}}_getOutputPixelType(n){return this.outputPixelType==="unknown"?n:this.outputPixelType??n}_getRasterValues(){const{rasterArgumentNames:n}=this;return n[0]==="rasters"&&Array.isArray(this.functionArguments.rasters)?this.functionArguments.rasters:n.map(i=>this.functionArguments[i])}_getSourceRasterInfos(n){const i=this._getRasterValues(),{rasterInfos:a,rasterIds:o}=n;return i.map(s=>s&&typeof s=="object"&&"bind"in s&&s.rasterInfo?s.rasterInfo:typeof s=="string"&&o.includes(s)?a[o.indexOf(s)]:a[0])}_getPrimaryRasterId(n){return n==null?void 0:n.url}_getPrimaryRasters(n,i=[],a=[]){for(let o=0;o<n.sourceRasters.length;o++){const s=n.sourceRasters[o];if(typeof s!="number")if("bind"in s)this._getPrimaryRasters(s,i,a);else{const r=s,e=this._getPrimaryRasterId(r);if(e==null)continue;a.includes(e)||(this.mainPrimaryRasterId===e?(i.unshift(r),a.unshift(e)):(i.push(r),a.push(e)))}}}_readRasterValue(n,i){const{primaryPixelBlocks:a}=i;if(T(n)||n==="$$"){const o=a[0];return T(o)?null:o.clone()}if(typeof n=="string"){const o=i.primaryRasterIds.indexOf(n);return o===-1?null:a[o]}if(typeof n=="number"){const o=a[0];if(T(o))return null;const s=new Float32Array(o.width*o.height);s.fill(n);const r=o.clone();return r.pixels=r.pixels.map(()=>s),r}return n.process(i)}};l([p({json:{write:!0}})],B.prototype,"functionName",void 0),l([p({json:{write:!0}})],B.prototype,"functionArguments",void 0),l([p()],B.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}}),re(t=>t==null?void 0:t.toLowerCase())],B.prototype,"outputPixelType",void 0),l([p({json:{write:!0}})],B.prototype,"mainPrimaryRasterId",void 0),l([p()],B.prototype,"sourceRasters",void 0),l([p({json:{write:!0}})],B.prototype,"sourceRasterInfos",void 0),l([p({json:{write:!0}})],B.prototype,"rasterInfo",void 0),l([p({json:{write:!0}})],B.prototype,"readingBufferSize",void 0),B=l([x("esri.layers.support.rasterFunctions.BaseRasterFunction")],B);const I=B;let C=class extends I{constructor(){super(...arguments),this.functionName="Aspect",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){const n=this.sourceRasterInfos[0];this.isGCS=n.spatialReference.isGeographic,this.outputPixelType=this._getOutputPixelType("f32");const i=n.clone();return i.pixelType=this.outputPixelType,i.statistics=null,i.histograms=null,this.rasterInfo=i,{success:!0}}_processPixels(n){var s;const i=(s=n.pixelBlocks)==null?void 0:s[0];if(T(i))return null;const{extent:a}=n,o=a?{x:a.width/i.width,y:a.height/i.height}:{x:1,y:1};return le(i,{resolution:o})}};l([p({json:{write:!0,name:"rasterFunction"}})],C.prototype,"functionName",void 0),l([p({type:Ae,json:{write:!0,name:"rasterFunctionArguments"}})],C.prototype,"functionArguments",void 0),l([p()],C.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],C.prototype,"isGCS",void 0),C=l([x("esri.layers.support.rasterFunctions.AspectFunction")],C);const ve=C,$e=new Set(["+","-","*","/","(",")"]);function Fe(t,n){(t=t.replace(/ /g,"")).startsWith("-")&&(t="0"+t),t.startsWith("+")&&(t=t.slice(1,t.length));const i=t.split(""),a=[],o=[];let s="";for(let r=0;r<i.length;r++){const e=i[r];if($e.has(e))s!==""&&o.push(parseFloat(s)),a.push(e),s="";else{if(e.toLowerCase()==="b"){r++,s=e.concat(i[r]),o.push(n[parseInt(s[1],10)-1]),s="";continue}s=s.concat(e),r===i.length-1&&o.push(parseFloat(s))}}return{ops:a,nums:o}}function Ne(t,n,i,a){if(typeof i=="number"&&typeof a=="number")return i+a;let o;if(typeof i=="number"){o=a.length;const r=i;(i=new Float32Array(o)).fill(r)}else if(o=i.length,a.constructor===Number){const r=a;(a=new Float32Array(o)).fill(r)}const s=new Float32Array(o);switch(n){case"+":for(let r=0;r<o;r++)(t==null||t[r])&&(s[r]=i[r]+a[r]);break;case"-":for(let r=0;r<o;r++)(t==null||t[r])&&(s[r]=i[r]-a[r]);break;case"*":for(let r=0;r<o;r++)(t==null||t[r])&&(s[r]=i[r]*a[r]);break;case"/":for(let r=0;r<o;r++)(t==null||t[r])&&a[r]&&(s[r]=i[r]/a[r]);break;case"(":case")":throw"encountered error with custom band index equation"}return s}function be(t,n){t.splice(n,1);let i=0,a=0;do{i=0,a=0;for(let o=0;o<t.length;o++)if(t[o]==="(")i=o;else if(t[o]===")"){a=o;break}a===i+1&&t.splice(i,2)}while(a===i+1);return t}function Se(t){if(t.length===1)return{opIndex:0,numIndex:0};let n=0,i=0;for(let r=0;r<t.length;r++)if(t[r]==="(")n=r;else if(t[r]===")"){i=r;break}const a=i===0?t:t.slice(n+1,i);let o=-1;for(let r=0;r<a.length;r++)if(a[r]==="*"||a[r]==="/"){o=r;break}if(o>-1)i>0&&(o+=n+1);else{for(let r=0;r<a.length;r++)if(a[r]==="+"||a[r]==="-"){o=r;break}i>0&&(o+=n+1)}let s=0;for(let r=0;r<o;r++)t[r]==="("&&s++;return{opIndex:o,numIndex:o-s}}function Te(t,n,i){let a,{ops:o,nums:s}=Fe(i,n);if(o.length===0){const r=s.length===1?s[0]:n[0];if(r instanceof Float32Array)return[r];const e=new Float32Array(n[0].length);return typeof r=="number"?e.fill(r):e.set(r),[e]}for(;o.length>0;){const{numIndex:r,opIndex:e}=Se(o);if(a=Ne(t,o[e],s[r],s[r+1]),o.length===1)break;o=be(o,e),s.splice(r,2,a)}return[a]}const Re=new Bt({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function Ie(t,n){if(!me(t))return t;const{equation:i,method:a}=n,o=n.bandIndexes.map(h=>h-1),{pixels:s,mask:r}=t;let e;switch(a){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":e=Dt(r,s[o[0]],s[o[1]]);break;case"ndwi":e=Dt(r,s[o[1]],s[o[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":e=Pe(r,s[o[0]],s[o[1]]);break;case"ci-g":case"ci-re":e=je(r,s[o[0]],s[o[1]]);break;case"savi":e=ke(r,s[o[0]],s[o[1]],o[2]+1);break;case"tsavi":e=Me(r,s[o[0]],s[o[1]],o[2]+1,o[3]+1,o[4]+1);break;case"msavi":e=De(r,s[o[0]],s[o[1]]);break;case"gemi":e=Ce(r,s[o[0]],s[o[1]]);break;case"pvi":e=Ee(r,s[o[0]],s[o[1]],o[2]+1,o[3]+1);break;case"gvitm":e=_e(r,[s[o[0]],s[o[1]],s[o[2]],s[o[3]],s[o[4]],s[o[5]]]);break;case"sultan":e=Oe(r,[s[o[0]],s[o[1]],s[o[2]],s[o[3]],s[o[4]],s[o[5]]]);break;case"vari":e=Ge(r,[s[o[0]],s[o[1]],s[o[2]]]);break;case"mtvi2":e=Le(r,[s[o[0]],s[o[1]],s[o[2]]]);break;case"rtvi-core":e=Ve(r,[s[o[0]],s[o[1]],s[o[2]]]);break;case"evi":e=ze(r,[s[o[0]],s[o[1]],s[o[2]]]);break;case"wndwi":e=qe(r,[s[o[0]],s[o[1]],s[o[2]]],o[3]??.5);break;case"bai":e=He(r,s[o[0]],s[o[1]]);break;case"custom":e=Te(r,s,i);break;default:return t}const u=j(r)?new Uint8Array(r.length):null;j(r)&&j(u)&&u.set(r);const c=new g({width:t.width,height:t.height,pixelType:"f32",pixels:e,mask:u});return c.updateStatistics(),c}function Be(t,n,i,a){const{mask:o,pixels:s,width:r,height:e}=t,u=s[i],c=s[n],h=c.length,f=a?new Uint8Array(h):new Float32Array(h),m=a?100:1,v=a?100:0;for(let A=0;A<h;A++)if(o==null||o[A]){const N=u[A],jt=c[A],kt=N+jt;kt&&(f[A]=(N-jt)/kt*m+v)}const w=new g({width:r,height:e,mask:o,pixelType:a?"u8":"f32",pixels:[f]});return w.updateStatistics(),w}function Dt(t,n,i){const a=i.length,o=new Float32Array(a);for(let s=0;s<a;s++)if(t==null||t[s]){const r=n[s],e=i[s],u=r+e;u&&(o[s]=(r-e)/u)}return[o]}function Pe(t,n,i){const a=i.length,o=new Float32Array(a);for(let s=0;s<a;s++)if(t==null||t[s]){const r=n[s],e=i[s];e&&(o[s]=r/e)}return[o]}function je(t,n,i){const a=n.length,o=new Float32Array(a);for(let s=0;s<a;s++)if(t==null||t[s]){const r=n[s],e=i[s];e&&(o[s]=r/e-1)}return[o]}function ke(t,n,i,a){const o=i.length,s=new Float32Array(o);for(let r=0;r<o;r++)if(t==null||t[r]){const e=i[r],u=n[r],c=u+e+a;c&&(s[r]=(u-e)/c*(1+a))}return[s]}function Me(t,n,i,a,o,s){const r=i.length,e=new Float32Array(r),u=-o*a+s*(1+a*a);for(let c=0;c<r;c++)if(t==null||t[c]){const h=i[c],f=n[c],m=o*f+h+u;m&&(e[c]=a*(f-a*h-o)/m)}return[e]}function De(t,n,i){const a=i.length,o=new Float32Array(a);for(let s=0;s<a;s++)if(t==null||t[s]){const r=i[s],e=n[s];o[s]=.5*(2*(e+1)-Math.sqrt((2*e+1)**2-8*(e-r)))}return[o]}function Ce(t,n,i){const a=i.length,o=new Float32Array(a);for(let s=0;s<a;s++)if(t==null||t[s]){const r=i[s],e=n[s];if(r!==1){const u=(2*(e*e-r*r)+1.5*e+.5*r)/(e+r+.5);o[s]=u*(1-.25*u)-(r-.125)/(1-r)}}return[o]}function Ee(t,n,i,a,o){const s=i.length,r=new Float32Array(s),e=Math.sqrt(1+a*a);for(let u=0;u<s;u++)if(t==null||t[u]){const c=i[u],h=n[u];r[u]=(h-a*c-o)/e}return[r]}function _e(t,n){const[i,a,o,s,r,e]=n,u=i.length,c=new Float32Array(u);for(let h=0;h<u;h++)(t==null||t[h])&&(c[h]=-.2848*i[h]-.2435*a[h]-.5436*o[h]+.7243*s[h]+.084*r[h]-1.18*e[h]);return[c]}function Oe(t,n){const[i,,a,o,s,r]=n,e=i.length,u=new Float32Array(e),c=new Float32Array(e),h=new Float32Array(e);for(let f=0;f<e;f++)(t==null||t[f])&&(u[f]=r[f]?s[f]/r[f]*100:0,c[f]=i[f]?s[f]/i[f]*100:0,h[f]=o[f]?a[f]/o[f]*(s[f]/o[f])*100:0);return[u,c,h]}function Ge(t,n){const[i,a,o]=n,s=i.length,r=new Float32Array(s);for(let e=0;e<s;e++)if(t==null||t[e])for(e=0;e<s;e++){const u=i[e],c=a[e],h=c+u-o[e];h&&(r[e]=(c-u)/h)}return[r]}function Le(t,n){const[i,a,o]=n,s=i.length,r=new Float32Array(s);for(let e=0;e<s;e++)if(t==null||t[e])for(e=0;e<s;e++){const u=i[e],c=a[e],h=o[e],f=Math.sqrt((2*u+1)**2-6*u-5*Math.sqrt(c)-.5);r[e]=1.5*(1.2*(u-h)-2.5*(c-h))*f}return[r]}function Ve(t,n){const[i,a,o]=n,s=i.length,r=new Float32Array(s);for(let e=0;e<s;e++)if(t==null||t[e])for(e=0;e<s;e++){const u=i[e],c=a[e],h=o[e];r[e]=100*(u-c)-10*(u-h)}return[r]}function ze(t,n){const[i,a,o]=n,s=i.length,r=new Float32Array(s);for(let e=0;e<s;e++)if(t==null||t[e])for(e=0;e<s;e++){const u=i[e],c=a[e],h=u+6*c-7.5*o[e]+1;h&&(r[e]=2.5*(u-c)/h)}return[r]}function qe(t,n,i=.5){const[a,o,s]=n,r=o.length,e=new Float32Array(r);for(let u=0;u<r;u++)if(t==null||t[u])for(u=0;u<r;u++){const c=a[u],h=o[u],f=s[u],m=c+i*h+(1-i)*f;m&&(e[u]=(c-i*h-(1-i)*f)/m)}return[e]}function He(t,n,i){const a=i.length,o=new Float32Array(a);for(let s=0;s<a;s++)if(t==null||t[s])for(s=0;s<a;s++){const r=(.1-n[s])**2+(.06-i[s])**2;r&&(o[s]=1/r)}return[o]}var gt;let et=gt=class extends R{constructor(){super(...arguments),this.method="custom"}clone(){return new gt({method:this.method,bandIndexes:this.bandIndexes,raster:k(this.raster)})}};l([p({json:{type:String,write:!0}})],et.prototype,"bandIndexes",void 0),l([tt(Re)],et.prototype,"method",void 0),et=gt=l([x("esri.layers.support.rasterFunctions.BandArithmeticFunctionArguments")],et);const Ue=et;let U=class extends I{constructor(){super(...arguments),this.functionName="BandArithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const n=this.sourceRasterInfos[0],i=n.clone();return i.pixelType=this.outputPixelType,i.statistics=null,i.histograms=null,i.bandCount=this.functionArguments.method==="sultan"?n.bandCount:1,this.rasterInfo=i,{success:!0}}_processPixels(n){var r;const i=(r=n.pixelBlocks)==null?void 0:r[0];if(T(i))return i;const{method:a,bandIndexes:o}=this.functionArguments,s=o.split(" ").map(e=>parseFloat(e));return Ie(i,{method:a,bandIndexes:s,equation:o})}};l([p({json:{write:!0,name:"rasterFunction"}})],U.prototype,"functionName",void 0),l([p({type:Ue,json:{write:!0,name:"rasterFunctionArguments"}})],U.prototype,"functionArguments",void 0),l([p()],U.prototype,"rasterArgumentNames",void 0),U=l([x("esri.layers.support.rasterFunctions.BandArithmeticFunction")],U);const Xe=U;var yt;let M=yt=class extends R{readColorRamp(t){return ie(t)}clone(){var t;return new yt({colormap:k(this.colormap),colormapName:this.colormapName,colorRamp:(t=this.colorRamp)==null?void 0:t.clone(),colorRampName:this.colorRampName})}};l([p({type:[[Number]],json:{write:!0}})],M.prototype,"colormap",void 0),l([p({type:String,json:{write:!0}})],M.prototype,"colormapName",void 0),l([p({types:oe,json:{write:!0}})],M.prototype,"colorRamp",void 0),l([ft("colorRamp")],M.prototype,"readColorRamp",null),l([p({type:String,json:{write:!0}})],M.prototype,"colorRampName",void 0),M=yt=l([x("esri.layers.support.rasterFunctions.ColormapFunctionArguments")],M);const We=M;let E=class extends I{constructor(){super(...arguments),this.functionName="Colormap",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const n=this.sourceRasterInfos[0];if(n.bandCount>1)return{success:!1,error:"colormap-function: source data must be single band"};let{colormap:i,colorRamp:a}=this.functionArguments;if(i!=null&&i.length||a&&(i=ce(a,256,!0)),!(i!=null&&i.length))return{success:!1,error:"colormap-function: missing colormap argument"};this.outputPixelType=this._getOutputPixelType("u8");const o=n.clone();return o.pixelType=this.outputPixelType,o.colormap=i,this.rasterInfo=o,{success:!0}}_processPixels(n){var i;return(i=n.pixelBlocks)==null?void 0:i[0]}};l([p({json:{write:!0,name:"rasterFunction"}})],E.prototype,"functionName",void 0),l([p({type:We,json:{write:!0,name:"rasterFunctionArguments"}})],E.prototype,"functionArguments",void 0),l([p()],E.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],E.prototype,"indexedColormap",void 0),E=l([x("esri.layers.support.rasterFunctions.ColormapFunction")],E);const Je=E;var xt;let nt=xt=class extends R{writeRasters(t,n){n.rasters=t.map(i=>typeof i=="number"||typeof i=="string"?i:i.toJSON())}clone(){return new xt({rasters:k(this.rasters)})}};l([p({json:{write:!0}})],nt.prototype,"rasters",void 0),l([at("rasters")],nt.prototype,"writeRasters",null),nt=xt=l([x("esri.layers.support.rasterFunctions.CompositeBandFunctionArguments")],nt);const Ye=nt;let X=class extends I{constructor(){super(...arguments),this.functionName="CompositeBand",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:n}=this,i=n[0];this.outputPixelType=this._getOutputPixelType(i.pixelType);const a=i.clone();if(a.attributeTable=null,a.colormap=null,a.pixelType=this.outputPixelType,a.bandCount=n.map(({bandCount:o})=>o).reduce((o,s)=>o+s),n.every(({statistics:o})=>j(o)&&o.length)){const o=[];n.forEach(({statistics:s})=>j(s)&&o.push(...s)),a.statistics=o}if(n.every(({histograms:o})=>j(o)&&o.length)){const o=[];n.forEach(({histograms:s})=>j(s)&&o.push(...s)),a.histograms=o}return this.rasterInfo=a,{success:!0}}_processPixels(n){const{pixelBlocks:i}=n;if(!i)return null;const a=i==null?void 0:i[0];return T(a)?null:de(i)}};l([p({json:{write:!0,name:"rasterFunction"}})],X.prototype,"functionName",void 0),l([p({type:Ye,json:{write:!0,name:"rasterFunctionArguments"}})],X.prototype,"functionArguments",void 0),l([p()],X.prototype,"rasterArgumentNames",void 0),X=l([x("esri.layers.support.rasterFunctions.CompositeBandFunction")],X);const Ke=X;var y;(function(t){t[t.UserDefined=-1]="UserDefined",t[t.LineDetectionHorizontal=0]="LineDetectionHorizontal",t[t.LineDetectionVertical=1]="LineDetectionVertical",t[t.LineDetectionLeftDiagonal=2]="LineDetectionLeftDiagonal",t[t.LineDetectionRightDiagonal=3]="LineDetectionRightDiagonal",t[t.GradientNorth=4]="GradientNorth",t[t.GradientWest=5]="GradientWest",t[t.GradientEast=6]="GradientEast",t[t.GradientSouth=7]="GradientSouth",t[t.GradientNorthEast=8]="GradientNorthEast",t[t.GradientNorthWest=9]="GradientNorthWest",t[t.SmoothArithmeticMean=10]="SmoothArithmeticMean",t[t.Smoothing3x3=11]="Smoothing3x3",t[t.Smoothing5x5=12]="Smoothing5x5",t[t.Sharpening3x3=13]="Sharpening3x3",t[t.Sharpening5x5=14]="Sharpening5x5",t[t.Laplacian3x3=15]="Laplacian3x3",t[t.Laplacian5x5=16]="Laplacian5x5",t[t.SobelHorizontal=17]="SobelHorizontal",t[t.SobelVertical=18]="SobelVertical",t[t.Sharpen=19]="Sharpen",t[t.Sharpen2=20]="Sharpen2",t[t.PointSpread=21]="PointSpread",t[t.None=255]="None"})(y||(y={}));const $=new Map;function Qe(t){const n=Math.sqrt(t.length),i=t.slice(0,n),a=[1];for(let o=1;o<n;o++){let s=null;for(let r=0;r<n;r++){const e=t[r+o*n],u=t[r];if(s==null)if(u===0){if(e)return{separable:!1,row:null,col:null}}else s=e/u;else if(e/u!==s)return{separable:!1,row:null,col:null}}if(s==null)return{separable:!1,row:null,col:null};a.push(s)}return{separable:!0,row:i,col:a}}function Ct(t,n,i,a,o,s,r){const e=new Float32Array(n*i),u=s.length,c=r?0:a,h=r?a:0,f=r?1:n;for(let m=c;m<i-c;m++){const v=m*n;for(let w=h;w<n-h;w++){if(o&&!o[v+w])continue;let A=0;for(let N=0;N<u;N++)A+=t[v+w+(N-a)*f]*s[N];e[v+w]=A}}return e}function Ze(t,n,i,a,o,s,r){const e=new Float32Array(n*i),u=Math.floor(a/2),c=Math.floor(o/2);for(let h=u;h<i-u;h++){const f=h*n;for(let m=c;m<n-c;m++){if(s&&!s[f+m])continue;let v=0;for(let w=0;w<a;w++)for(let A=0;A<o;A++)v+=t[f+m+(w-u)*n+A-c]*r[w*o+A];e[f+m]=v}}return e}function tn(t,n,i=!0){const{pixels:a,width:o,height:s,pixelType:r,mask:e}=t,u=a.length,c=[],{kernel:h,rows:f,cols:m}=n;for(let v=0;v<u;v++){const w=Ze(a[v],o,s,f,m,e,h);i&&zt(w,o,s,f,m),c.push(w)}return new g({width:o,height:s,pixelType:r,pixels:c,mask:e})}function zt(t,n,i,a,o){const s=Math.floor(a/2);for(let e=0;e<s;e++)for(let u=0;u<n;u++)t[e*n+u]=t[(o-1-e)*n+u],t[(i-1-e)*n+u]=t[(i-o+e)*n+u];const r=Math.floor(o/2);for(let e=0;e<i;e++){const u=e*n;for(let c=0;c<r;c++)t[u+c]=t[u+o-1-c],t[u+n-c-1]=t[u+n+c-o]}}function en(t,n,i,a=!0){const{pixels:o,width:s,height:r,pixelType:e,mask:u}=t,c=o.length,h=[],f=n.length,m=i.length,v=Math.floor(f/2),w=Math.floor(m/2);for(let A=0;A<c;A++){let N=Ct(o[A],s,r,v,u,n,!0);N=Ct(N,s,r,w,u,i,!1),a&&zt(N,s,r,f,m),h.push(N)}return new g({width:s,height:r,pixelType:e,pixels:h,mask:u})}function nn(t,n){const i=Qe(n.kernel),a=n.mirrorEdges!==!1,o=i.separable?en(t,i.row,i.col,a):tn(t,n,a),{outputPixelType:s}=n;return s&&o.clamp(s),o}$.set(y.None,[0,0,0,0,1,0,0,0,0]),$.set(y.LineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]),$.set(y.LineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]),$.set(y.LineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]),$.set(y.LineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]),$.set(y.GradientNorth,[-1,-2,-1,0,0,0,1,2,1]),$.set(y.GradientWest,[-1,0,1,-2,0,2,-1,0,1]),$.set(y.GradientEast,[1,0,-1,2,0,-2,1,0,-1]),$.set(y.GradientSouth,[1,2,1,0,0,0,-1,-2,-1]),$.set(y.GradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]),$.set(y.GradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]),$.set(y.SmoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]),$.set(y.Smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]),$.set(y.Smoothing5x5,[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]),$.set(y.Sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]),$.set(y.Sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]),$.set(y.Laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]),$.set(y.Laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]),$.set(y.SobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]),$.set(y.SobelVertical,[-1,0,1,-2,0,2,-1,0,1]),$.set(y.Sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]),$.set(y.Sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]),$.set(y.PointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);var wt;let _=wt=class extends R{constructor(){super(...arguments),this.rows=3,this.cols=3,this.kernel=[0,0,0,0,1,0,0,0,0]}set kernelType(t){this._set("kernelType",t);const n=$.get(t);if(!n||t===y.UserDefined||t===y.None)return;const i=Math.sqrt(n.length);this._set("kernel",n),this._set("cols",i),this._set("rows",i)}clone(){return new wt({cols:this.cols,rows:this.rows,kernel:[...this.kernel],kernelType:this.kernelType,raster:k(this.raster)})}};l([p({json:{type:Number,write:!0}})],_.prototype,"rows",void 0),l([p({json:{type:Number,write:!0}})],_.prototype,"cols",void 0),l([p({json:{name:"type",type:Number,write:!0}})],_.prototype,"kernelType",null),l([p({json:{type:[Number],write:!0}})],_.prototype,"kernel",void 0),_=wt=l([x("esri.layers.support.rasterFunctions.ConvolutionFunctionArguments")],_);const sn=_;let W=class extends I{constructor(){super(...arguments),this.functionName="Convolution",this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{kernelType:n,rows:i,cols:a,kernel:o}=this.functionArguments;if(!$.has(n))return{success:!1,error:`convolution-function: the specified kernel type is not supported ${n}`};if(n!==y.None&&i*a!==o.length)return{success:!1,error:"convolution-function: the specified rows and cols do not match the length of the kernel"};const s=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(s.pixelType);const r=s.clone();r.pixelType=this.outputPixelType;const e=[y.None,y.Sharpen,y.Sharpen2,y.Sharpening3x3,y.Sharpening5x5];return this.outputPixelType==="u8"||e.includes(n)||(r.statistics=null,r.histograms=null),this.rasterInfo=r,{success:!0}}_processPixels(n){var e;const i=(e=n.pixelBlocks)==null?void 0:e[0];if(T(i)||this.functionArguments.kernelType===y.None)return i;let{kernel:a,rows:o,cols:s}=this.functionArguments;const r=a.reduce((u,c)=>u+c);return r!==0&&r!==1&&(a=a.map(u=>u/r)),nn(i,{kernel:a,rows:o,cols:s,outputPixelType:this.outputPixelType})}};l([p({json:{write:!0,name:"rasterFunction"}})],W.prototype,"functionName",void 0),l([p({type:sn,json:{write:!0,name:"rasterFunctionArguments"}})],W.prototype,"functionArguments",void 0),l([p()],W.prototype,"rasterArgumentNames",void 0),W=l([x("esri.layers.support.rasterFunctions.ConvolutionFunction")],W);const rn=W;var At;let st=At=class extends R{constructor(){super(...arguments),this.bandIDs=[],this.missingBandAction=Gt.bestMatch}clone(){return new At({bandIDs:[...this.bandIDs],missingBandAction:this.missingBandAction})}};l([p({json:{write:!0}})],st.prototype,"bandIDs",void 0),l([p({json:{write:!0}})],st.prototype,"missingBandAction",void 0),st=At=l([x("esri.layers.support.rasterFunctions.ExtractBandFunctionArguments")],st);const on=st;let J=class extends I{constructor(){super(...arguments),this.functionName="ExtractBand",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{sourceRasterInfos:n}=this,i=n[0],{bandCount:a}=i,{bandIDs:o,missingBandAction:s}=this.functionArguments;if(s===Gt.fail&&o.some(c=>c<0||c>=a))return{success:!1,error:"extract-band-function: invalid bandIDs"};this.outputPixelType=this._getOutputPixelType("f32");const r=i.clone();r.pixelType=this.outputPixelType;const{statistics:e,histograms:u}=r;return j(e)&&e.length&&(r.statistics=o.map(c=>e[c]||e[e.length-1])),j(u)&&u.length&&(r.histograms=o.map(c=>u[c]||u[u.length-1])),this.rasterInfo=r,{success:!0}}_processPixels(n){var s;const i=(s=n.pixelBlocks)==null?void 0:s[0];if(T(i))return null;const a=i.pixels.length,o=this.functionArguments.bandIDs.map(r=>r>=a?a-1:r);return i.extractBands(o)}};l([p({json:{write:!0,name:"rasterFunction"}})],J.prototype,"functionName",void 0),l([p({type:on,json:{write:!0,name:"rasterFunctionArguments"}})],J.prototype,"functionArguments",void 0),l([p()],J.prototype,"rasterArgumentNames",void 0),J=l([x("esri.layers.support.rasterFunctions.ExtractBandFunction")],J);const an=J;var vt;let O=vt=class extends R{constructor(){super(...arguments),this.rasters=[],this.processAsMultiband=!1}writeRasters(t,n){n.rasters=t.map(i=>typeof i=="number"||typeof i=="string"?i:i.toJSON())}clone(){return new vt({method:this.operation,processAsMultiband:this.processAsMultiband,rasters:k(this.rasters)})}};l([p({json:{write:!0}})],O.prototype,"operation",void 0),l([p({json:{write:!0}})],O.prototype,"rasters",void 0),l([at("rasters")],O.prototype,"writeRasters",null),l([p({json:{write:!0}})],O.prototype,"processAsMultiband",void 0),O=vt=l([x("esri.layers.support.rasterFunctions.LocalFunctionArguments")],O);const un=O;var ct;(function(t){t[t.Plus=1]="Plus",t[t.Minus=2]="Minus",t[t.Times=3]="Times",t[t.SquareRoot=4]="SquareRoot",t[t.Power=5]="Power",t[t.ACos=6]="ACos",t[t.ASin=7]="ASin",t[t.ATan=8]="ATan",t[t.ATanH=9]="ATanH",t[t.Abs=10]="Abs",t[t.BitwiseAnd=11]="BitwiseAnd",t[t.BitwiseLeftShift=12]="BitwiseLeftShift",t[t.BitwiseNot=13]="BitwiseNot",t[t.BitwiseOr=14]="BitwiseOr",t[t.BitwiseRightShift=15]="BitwiseRightShift",t[t.BitwiseXOr=16]="BitwiseXOr",t[t.BooleanAnd=17]="BooleanAnd",t[t.BooleanNot=18]="BooleanNot",t[t.BooleanOr=19]="BooleanOr",t[t.BooleanXOr=20]="BooleanXOr",t[t.Cos=21]="Cos",t[t.CosH=22]="CosH",t[t.Divide=23]="Divide",t[t.EqualTo=24]="EqualTo",t[t.Exp=25]="Exp",t[t.Exp10=26]="Exp10",t[t.Exp2=27]="Exp2",t[t.GreaterThan=28]="GreaterThan",t[t.GreaterThanEqual=29]="GreaterThanEqual",t[t.Int=30]="Int",t[t.IsNull=31]="IsNull",t[t.Float=32]="Float",t[t.LessThan=33]="LessThan",t[t.LessThanEqual=34]="LessThanEqual",t[t.Ln=35]="Ln",t[t.Log10=36]="Log10",t[t.Log2=37]="Log2",t[t.Majority=38]="Majority",t[t.Max=39]="Max",t[t.Mean=40]="Mean",t[t.Med=41]="Med",t[t.Min=42]="Min",t[t.Minority=43]="Minority",t[t.Mod=44]="Mod",t[t.Negate=45]="Negate",t[t.NotEqual=46]="NotEqual",t[t.Range=47]="Range",t[t.RoundDown=48]="RoundDown",t[t.RoundUp=49]="RoundUp",t[t.SetNull=50]="SetNull",t[t.Sin=51]="Sin",t[t.SinH=52]="SinH",t[t.Square=53]="Square",t[t.Std=54]="Std",t[t.Sum=55]="Sum",t[t.Tan=56]="Tan",t[t.TanH=57]="TanH",t[t.Variety=58]="Variety",t[t.ACosH=59]="ACosH",t[t.ASinH=60]="ASinH",t[t.ATan2=61]="ATan2",t[t.FloatDivide=64]="FloatDivide",t[t.FloorDivide=65]="FloorDivide",t[t.MajorityIgnoreNoData=66]="MajorityIgnoreNoData",t[t.MaxIgnoreNoData=67]="MaxIgnoreNoData",t[t.MeanIgnoreNoData=68]="MeanIgnoreNoData",t[t.MedIgnoreNoData=69]="MedIgnoreNoData",t[t.MinIgnoreNoData=70]="MinIgnoreNoData",t[t.MinorityIgnoreNoData=71]="MinorityIgnoreNoData",t[t.RangeIgnoreNoData=72]="RangeIgnoreNoData",t[t.StdIgnoreNoData=73]="StdIgnoreNoData",t[t.SumIgnoreNoData=74]="SumIgnoreNoData",t[t.VarietyIgnoreNoData=75]="VarietyIgnoreNoData",t[t.Con=76]="Con"})(ct||(ct={}));function ln(t){const n=t.map(r=>r.mask).filter(r=>j(r));if(n.length===0)return null;const i=n[0].length,a=new Uint8Array(i);if(n.length===1)return a.set(n[0]),a;let o,s=n[0];for(let r=1;r<n.length;r++){o=n[r];for(let e=0;e<i;e++)a[e]=s[e]|o[e];s=o}return a}function cn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]+o[e]);return r}function pn(t,n,i){const[a]=t,o=a.length,s=g.createEmptyBand("f32",o);return s.set(a),s}function hn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]-o[e]);return r}function fn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]*o[e]);return r}function qt(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=o[e]===0?0:a[e]/o[e]);return r}function mn(t,n,i){return qt(t,n,"f32")}function dn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=o[e]===0?0:Math.floor(a[e]/o[e]));return r}function gn(t,n,i,a){const[o]=t,s=o.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a(o[e]));return r}function yn(t,n,i,a){const[o,s]=t,r=o.length,e=g.createEmptyBand(i,r);for(let u=0;u<r;u++)n&&!n[u]||(e[u]=a(o[u],s[u]));return e}function xn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]&o[e]);return r}function Et(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]<<o[e]);return r}function wn(t,n,i){const[a]=t,o=a.length,s=g.createEmptyBand(i,o);for(let r=0;r<o;r++)n&&!n[r]||(s[r]=~a[r]);return s}function An(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]|o[e]);return r}function vn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]>>o[e]);return r}function $n(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]^o[e]);return r}function Fn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]&&o[e]?1:0);return r}function Nn(t,n,i){const[a]=t,o=a.length,s=g.createEmptyBand(i,o);for(let r=0;r<o;r++)n&&!n[r]||(s[r]=a[r]?0:1);return s}function bn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]||o[e]?1:0);return r}function Sn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=(a[e]?1:0)^(o[e]?1:0));return r}function Tn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]===o[e]?1:0);return r}function Ht(t,n,i,a){const[o]=t,s=o.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a**o[e]);return r}function Rn(t,n,i){return Ht(t,n,i,10)}function In(t,n,i){return Ht(t,n,i,2)}function Bn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]>o[e]?1:0);return r}function Pn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]>=o[e]?1:0);return r}function jn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]<o[e]?1:0);return r}function kn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]<=o[e]?1:0);return r}function Mn(t,n,i){const[a]=t,o=a.length,s=g.createEmptyBand(i,o);if(!n)return s;for(let r=0;r<o;r++)s[r]=n[r]?0:1;return s}function Dn(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]%o[e]);return r}function Cn(t,n,i){const[a]=t,o=a.length,s=g.createEmptyBand(i,o);for(let r=0;r<o;r++)n&&!n[r]||(s[r]=-a[r]);return s}function En(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)n&&!n[e]||(r[e]=a[e]===o[e]?0:1);return r}function _n(t,n,i){const[a,o]=t,s=a.length,r=g.createEmptyBand(i,s),e=new Uint8Array(s);for(let u=0;u<s;u++)n!=null&&!n[u]||a[u]!==0||(r[u]=o[u],e[u]=255);return{band:r,mask:e}}function On(t,n,i){const[a,o,s]=t,r=a.length,e=g.createEmptyBand(i,r);for(let u=0;u<r;u++)n&&!n[u]||(e[u]=a[u]?o[u]:s[u]);return e}function Ut(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s);r.set(o);for(let e=0;e<s;e++)if(!n||n[e])for(let u=1;u<a;u++){const c=t[u];r[e]<c[e]&&(r[e]=c[e])}return r}function Xt(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s);r.set(o);for(let e=0;e<s;e++)if(!n||n[e])for(let u=1;u<a;u++){const c=t[u];r[e]>c[e]&&(r[e]=c[e])}return r}function Wt(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s);r.set(o);for(let e=0;e<s;e++)if(!n||n[e]){let u=r[e];for(let c=1;c<a;c++){const h=t[c];r[e]<h[e]&&(r[e]=h[e]),u>h[e]&&(u=h[e])}r[e]-=u}return r}function Jt(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s);r.set(o);for(let e=0;e<s;e++)if(!n||n[e]){for(let u=1;u<a;u++){const c=t[u];r[e]+=c[e]}r[e]/=a}return r}function Yt(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s);r.set(o);for(let e=0;e<s;e++)if(!n||n[e])for(let u=1;u<a;u++){const c=t[u];r[e]+=c[e]}return r}function Kt(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s);for(let e=0;e<s;e++)if(!n||n[e]){const u=new Float32Array(a);let c=0;for(let f=0;f<a;f++){const m=t[f];c+=m[e],u[f]=m[e]}c/=a;let h=0;for(let f=0;f<a;f++)h+=(u[f]-c)*u[f]-c;r[e]=Math.sqrt(h/a-1)}return r}function Qt(t,n,i){const a=t.length;if(a<2)return t[0];const o=Math.floor(a/2),[s]=t,r=s.length,e=g.createEmptyBand(i,r),u=new Float32Array(a);for(let c=0;c<r;c++)if(!n||n[c]){for(let h=0;h<a;h++)u[h]=t[h][c];u.sort(),e[c]=u[o]}return e}function Zt(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s),e=new Map;for(let u=0;u<s;u++)if(!n||n[u]){let c;e.clear();for(let m=0;m<a;m++)c=t[m][u],e.set(c,e.has(c)?e.get(c)+1:1);let h=0,f=0;for(const m of e.keys())h=e.get(m),h>f&&(f=h,c=m);r[u]=c}return r}function te(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s),e=new Map;for(let u=0;u<s;u++)if(!n||n[u]){let c;e.clear();for(let m=0;m<a;m++)c=t[m][u],e.set(c,e.has(c)?e.get(c)+1:1);let h=0,f=t.length;for(const m of e.keys())h=e.get(m),h<f&&(f=h,c=m);r[u]=c}return r}function ee(t,n,i){const a=t.length;if(a<2)return t[0];const[o]=t,s=o.length,r=g.createEmptyBand(i,s),e=new Set;for(let u=0;u<s;u++)if(!n||n[u]){let c;e.clear();for(let h=0;h<a;h++)c=t[h][u],e.add(c);r[u]=e.size}return r}function Gn(t,n,i){return Zt(t,null,i)}function Ln(t,n,i){return te(t,null,i)}function Vn(t,n,i){return ee(t,null,i)}function zn(t,n,i){return Ut(t,null,i)}function qn(t,n,i){return Xt(t,null,i)}function Hn(t,n,i){return Kt(t,null,i)}function Un(t,n,i){return Yt(t,null,i)}function Xn(t,n,i){return Jt(t,null,i)}function Wn(t,n,i){return Qt(t,null,i)}function Jn(t,n,i){return Wt(t,null,i)}const F=new Map,pt=new Map,d=new Map;function Yn(){F.size||(F.set(4,Math.sqrt),F.set(6,Math.acos),F.set(7,Math.asin),F.set(8,Math.atan),F.set(9,Math.atanh),F.set(10,Math.abs),F.set(21,Math.cos),F.set(22,Math.cosh),F.set(25,Math.exp),F.set(30,Math.floor),F.set(35,Math.log),F.set(36,Math.log10),F.set(37,Math.log2),F.set(48,Math.floor),F.set(49,Math.ceil),F.set(51,Math.sin),F.set(52,Math.sinh),F.set(56,Math.tan),F.set(57,Math.tanh),F.set(59,Math.acosh),F.set(60,Math.asinh),F.set(65,Math.floor),pt.set(5,Math.pow),pt.set(61,Math.atan2),d.set(1,cn),d.set(2,hn),d.set(3,fn),d.set(11,xn),d.set(12,Et),d.set(12,Et),d.set(13,wn),d.set(14,An),d.set(15,vn),d.set(16,$n),d.set(17,Fn),d.set(18,Nn),d.set(19,bn),d.set(20,Sn),d.set(23,qt),d.set(24,Tn),d.set(26,Rn),d.set(27,In),d.set(28,Bn),d.set(29,Pn),d.set(31,Mn),d.set(32,pn),d.set(33,jn),d.set(34,kn),d.set(44,Dn),d.set(45,Cn),d.set(46,En),d.set(64,mn),d.set(65,dn),d.set(76,On),d.set(38,Zt),d.set(39,Ut),d.set(40,Jt),d.set(41,Qt),d.set(42,Xt),d.set(43,te),d.set(47,Wt),d.set(54,Kt),d.set(55,Yt),d.set(58,ee),d.set(66,Gn),d.set(67,zn),d.set(68,Xn),d.set(69,Wn),d.set(70,qn),d.set(71,Ln),d.set(72,Jn),d.set(73,Hn),d.set(74,Un),d.set(75,Vn))}function Kn(t,n,i={}){Yn();const a=ae(ln(t)),{processAsMultiband:o,outputPixelType:s="f32"}=i,r=o?t[0].pixels.length:1,e=[];let u;for(let h=0;h<r;h++){const f=t.map(v=>v.pixels[h]);let m;if(n===ct.SetNull){const v=_n(f,a,s);m=v.band,u=v.mask}else d.has(n)?m=d.get(n)(f,a,s):F.has(n)?m=gn(f,a,s,F.get(n)):pt.has(n)&&(m=yn(f,a,s,pt.get(n)));if(m==null)return null;e.push(m)}u||n===ct.IsNull||(u=a);const c=t[0];return new g({width:c.width,height:c.height,pixelType:s,mask:u,pixels:e})}let Y=class extends I{constructor(){super(...arguments),this.functionName="Local",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:n}=this,i=n[0],{bandCount:a}=i,{processAsMultiband:o}=this.functionArguments;if(o&&n.some(r=>r.bandCount!==a))return{success:!1,error:"local-function: input rasters do not have same band count"};this.outputPixelType=this._getOutputPixelType("f32");const s=i.clone();return s.pixelType=this.outputPixelType,s.statistics=null,s.histograms=null,o||(s.bandCount=1),this.rasterInfo=s,{success:!0}}_processPixels(n){const{pixelBlocks:i}=n;return T(i)||i.some(a=>T(a))?null:Kn(i,this.functionArguments.operation,{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:this.outputPixelType??void 0})}};l([p({json:{write:!0,name:"rasterFunction"}})],Y.prototype,"functionName",void 0),l([p({type:un,json:{write:!0,name:"rasterFunctionArguments"}})],Y.prototype,"functionArguments",void 0),l([p()],Y.prototype,"rasterArgumentNames",void 0),Y=l([x("esri.layers.support.rasterFunctions.LocalFunction")],Y);const Qn=Y;var $t;let K=$t=class extends R{constructor(){super(...arguments),this.includedRanges=null,this.noDataValues=null,this.noDataInterpretation=Lt.matchAny}clone(){var t,n;return new $t({includedRanges:((t=this.includedRanges)==null?void 0:t.slice())??[],noDataValues:((n=this.noDataValues)==null?void 0:n.slice())??[],noDataInterpretation:this.noDataInterpretation})}};l([p({json:{write:!0}})],K.prototype,"includedRanges",void 0),l([p({json:{write:!0}})],K.prototype,"noDataValues",void 0),l([p({json:{write:!0}})],K.prototype,"noDataInterpretation",void 0),K=$t=l([x("esri.layers.support.rasterFunctions.MaskFunctionArguments")],K);const Zn=K;let G=class extends I{constructor(){super(...arguments),this.functionName="Mask",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const n=this.sourceRasterInfos[0].clone(),{pixelType:i}=n;this.outputPixelType=this._getOutputPixelType(i),n.pixelType=this.outputPixelType,this.rasterInfo=n;const{includedRanges:a,noDataValues:o}=this.functionArguments;return a!=null&&a.length||o!=null&&o.length?(this.lookup=ge(i,this.functionArguments.includedRanges,this.functionArguments.noDataValues),{success:!0}):{success:!1,error:"missing includedRanges or noDataValues argument"}}_processPixels(n){var c;const i=(c=n.pixelBlocks)==null?void 0:c[0];if(T(i))return null;const{outputPixelType:a,lookup:o}=this,{includedRanges:s,noDataValues:r,noDataInterpretation:e}=this.functionArguments,u=e===Lt.matchAll;return ye(i,{includedRanges:s,noDataValues:r,outputPixelType:a,matchAll:u,lookup:o})}};l([p({json:{write:!0,name:"rasterFunction"}})],G.prototype,"functionName",void 0),l([p({type:Zn,json:{write:!0,name:"rasterFunctionArguments"}})],G.prototype,"functionArguments",void 0),l([p()],G.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],G.prototype,"lookup",void 0),G=l([x("esri.layers.support.rasterFunctions.MaskFunction")],G);const ts=G;var Ft;let Q=Ft=class extends R{constructor(){super(...arguments),this.visibleBandID=0,this.infraredBandID=1,this.scaled=!0}clone(){const{visibleBandID:t,infraredBandID:n,scaled:i}=this;return new Ft({visibleBandID:t,infraredBandID:n,scaled:i})}};l([p({json:{write:!0}})],Q.prototype,"visibleBandID",void 0),l([p({json:{write:!0}})],Q.prototype,"infraredBandID",void 0),l([p({json:{write:!0}})],Q.prototype,"scaled",void 0),Q=Ft=l([x("esri.layers.support.rasterFunctions.NDVIFunctionArguments")],Q);const es=Q;let Z=class extends I{constructor(){super(...arguments),this.functionName="NDVI",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{scaled:n}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(n?"u8":"f32");const i=this.sourceRasterInfos[0].clone();i.pixelType=this.outputPixelType,i.colormap=null,i.histograms=null;const[a,o,s,r]=n?[0,200,100,10]:[-1,1,0,.1];return i.statistics=[{min:a,max:o,avg:s,stddev:r}],this.rasterInfo=i,{success:!0}}_processPixels(n){var r;const i=(r=n.pixelBlocks)==null?void 0:r[0];if(T(i))return null;const{visibleBandID:a,infraredBandID:o,scaled:s}=this.functionArguments;return Be(i,a,o,s)}};l([p({json:{write:!0,name:"rasterFunction"}})],Z.prototype,"functionName",void 0),l([p({type:es,json:{write:!0,name:"rasterFunctionArguments"}})],Z.prototype,"functionArguments",void 0),l([p()],Z.prototype,"rasterArgumentNames",void 0),Z=l([x("esri.layers.support.rasterFunctions.NDVIFunction")],Z);const ns=Z;var Nt;let L=Nt=class extends R{constructor(){super(...arguments),this.inputRanges=null,this.outputValues=null,this.noDataRanges=null,this.allowUnmatched=!1}clone(){return new Nt({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched})}};l([p({json:{write:!0}})],L.prototype,"inputRanges",void 0),l([p({json:{write:!0}})],L.prototype,"outputValues",void 0),l([p({json:{write:!0}})],L.prototype,"noDataRanges",void 0),l([p({json:{write:!0}})],L.prototype,"allowUnmatched",void 0),L=Nt=l([x("esri.layers.support.rasterFunctions.RemapFunctionArguments")],L);const ss=L;let V=class extends I{constructor(){super(...arguments),this.functionName="Remap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const n=this.sourceRasterInfos[0].clone(),{pixelType:i}=n;this.outputPixelType=this._getOutputPixelType(i),n.pixelType=this.outputPixelType,n.colormap=null,n.histograms=null;const{statistics:a}=n,{allowUnmatched:o,outputValues:s}=this.functionArguments;if(j(a)&&a.length&&!o){let r=s[0],e=r;for(let u=0;u<s.length;u++)r=r>s[u]?s[u]:r,e=e>s[u]?e:s[u];for(let u=0;u<a.length;u++)a[u]={...a[u],min:r,max:e}}return this.rasterInfo=n,this.lookup=o?null:xe(i,this.functionArguments.inputRanges,s),{success:!0}}_processPixels(n){var c;const i=(c=n.pixelBlocks)==null?void 0:c[0];if(T(i))return null;const{lookup:a,outputPixelType:o}=this;if(a)return Vt(i,{lut:[a.lut],offset:a.offset,outputPixelType:o});const{inputRanges:s,outputValues:r,noDataRanges:e,allowUnmatched:u}=this.functionArguments;return we(i,{inputRanges:s,outputValues:r,noDataRanges:e,allowUnmatched:u,outputPixelType:o})}};l([p({json:{write:!0,name:"rasterFunction"}})],V.prototype,"functionName",void 0),l([p({type:ss,json:{write:!0,name:"rasterFunctionArguments"}})],V.prototype,"functionArguments",void 0),l([p()],V.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],V.prototype,"lookup",void 0),V=l([x("esri.layers.support.rasterFunctions.RemapFunction")],V);const rs=V;var bt;const os=new Bt({0:"degree",1:"percent-rise",2:"adjusted"},{useNumericKeys:!0});let z=bt=class extends R{constructor(){super(...arguments),this.slopeType="degree",this.zFactor=1,this.pixelSizePower=.664,this.pixelSizeFactor=.024}clone(){return new bt({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,raster:this.raster})}};l([tt(os)],z.prototype,"slopeType",void 0),l([p({type:Number,json:{write:!0}})],z.prototype,"zFactor",void 0),l([p({type:Number,json:{name:"psPower",write:!0}})],z.prototype,"pixelSizePower",void 0),l([p({type:Number,json:{name:"psFactor",write:!0}})],z.prototype,"pixelSizeFactor",void 0),z=bt=l([x("esri.layers.support.rasterFunctions.SlopeFunctionArguments")],z);const is=z;let q=class extends I{constructor(){super(...arguments),this.functionName="Slope",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const n=this.sourceRasterInfos[0].clone();return n.pixelType=this.outputPixelType,n.statistics=null,n.histograms=null,this.rasterInfo=n,this.isGCS=n.spatialReference.isGeographic,{success:!0}}_processPixels(n){var h;const i=(h=n.pixelBlocks)==null?void 0:h[0];if(T(i))return null;const{zFactor:a,slopeType:o,pixelSizePower:s,pixelSizeFactor:r}=this.functionArguments,{isGCS:e}=this,{extent:u}=n,c=u?{x:u.width/i.width,y:u.height/i.height}:{x:1,y:1};return pe(i,{zFactor:a,slopeType:o,pixelSizePower:s,pixelSizeFactor:r,isGCS:e,resolution:c})}};l([p({json:{write:!0,name:"rasterFunction"}})],q.prototype,"functionName",void 0),l([p({type:is,json:{write:!0,name:"rasterFunctionArguments"}})],q.prototype,"functionArguments",void 0),l([p()],q.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],q.prototype,"isGCS",void 0),q=l([x("esri.layers.support.rasterFunctions.SlopeFunction")],q);const as=q;var St;let rt=St=class extends R{constructor(){super(...arguments),this.statistics=null,this.histograms=null}clone(){return new St({statistics:k(this.statistics),histograms:k(this.histograms)})}};l([p({json:{write:!0}})],rt.prototype,"statistics",void 0),l([p({json:{write:!0}})],rt.prototype,"histograms",void 0),rt=St=l([x("esri.layers.support.rasterFunctions.StatisticsHistogramsFunctionArguments")],rt);const us=rt;let H=class extends I{constructor(){super(...arguments),this.functionName="StatisticsHistograms",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const n=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType("u8");const i=n.clone(),{statistics:a,histograms:o}=this.functionArguments;return i.histograms=o,a&&(i.statistics=a.map(([s,r,e,u])=>({min:s,max:r,avg:e,stddev:u}))),this.rasterInfo=i,{success:!0}}_processPixels(n){var i;return(i=n.pixelBlocks)==null?void 0:i[0]}};l([p({json:{write:!0,name:"rasterFunction"}})],H.prototype,"functionName",void 0),l([p({type:us,json:{write:!0,name:"rasterFunctionArguments"}})],H.prototype,"functionArguments",void 0),l([p()],H.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],H.prototype,"indexedColormap",void 0),H=l([x("esri.layers.support.rasterFunctions.StatisticsHistogramsFunction")],H);const ls=H;var Tt;const cs=new Bt({0:"none",3:"standard-deviation",4:"histogram-equalization",5:"min-max",6:"percent-clip",7:"sigmoid"},{useNumericKeys:!0});let b=Tt=class extends R{constructor(){super(...arguments),this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.histograms=null,this.statistics=null,this.stretchType="none",this.useGamma=!1}writeStatistics(t,n,i){t!=null&&t.length&&(Array.isArray(t[0])||(t=t.map(a=>[a.min,a.max,a.avg,a.stddev])),n[i]=t)}clone(){return new Tt({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:k(this.statistics),gamma:k(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:k(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};l([p({type:Boolean,json:{write:!0}})],b.prototype,"computeGamma",void 0),l([p({type:Boolean,json:{name:"dra",write:!0}})],b.prototype,"dynamicRangeAdjustment",void 0),l([p({type:[Number],json:{write:!0}})],b.prototype,"gamma",void 0),l([p()],b.prototype,"histograms",void 0),l([p({type:Number,json:{write:!0}})],b.prototype,"maxPercent",void 0),l([p({type:Number,json:{write:!0}})],b.prototype,"minPercent",void 0),l([p({type:Number,json:{write:!0}})],b.prototype,"numberOfStandardDeviations",void 0),l([p({type:Number,json:{name:"max",write:!0}})],b.prototype,"outputMax",void 0),l([p({type:Number,json:{name:"min",write:!0}})],b.prototype,"outputMin",void 0),l([p({type:Number,json:{write:!0}})],b.prototype,"sigmoidStrengthLevel",void 0),l([p({json:{type:[[Number]],write:!0}})],b.prototype,"statistics",void 0),l([at("statistics")],b.prototype,"writeStatistics",null),l([tt(cs)],b.prototype,"stretchType",void 0),l([p({type:Boolean,json:{write:!0}})],b.prototype,"useGamma",void 0),b=Tt=l([x("esri.layers.support.rasterFunctions.StretchFunctionArguments")],b);const ps=b;let D=class extends I{constructor(){super(...arguments),this.functionName="Stretch",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;const n=this.sourceRasterInfos[0],{pixelType:i}=n,{functionArguments:a}=this,{dynamicRangeAdjustment:o,gamma:s,useGamma:r}=a;if(!o&&["u8","u16","s8","s16"].includes(i)){const u=ht(a.toJSON(),{rasterInfo:n});this.lookup=he({pixelType:i,...u,gamma:r?s:null})}else o&&(this.cutOffs=ht(a.toJSON(),{rasterInfo:n}));this.outputPixelType=this._getOutputPixelType(i);const e=n.clone();return e.pixelType=this.outputPixelType,e.statistics=null,e.histograms=null,this.outputPixelType==="u8"&&(e.keyProperties.DataType="processed"),this.rasterInfo=e,{success:!0}}_processPixels(n){var e;const i=(e=n.pixelBlocks)==null?void 0:e[0];if(T(i))return i;const{lookup:a}=this;if(a)return Vt(i,{...a,outputPixelType:this.rasterInfo.pixelType});const{functionArguments:o}=this,s=this.cutOffs||ht(o.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:i}),r=o.useGamma?o.gamma:null;return fe(i,{...s,gamma:r,outputPixelType:this.outputPixelType})}};l([p({json:{write:!0,name:"rasterFunction"}})],D.prototype,"functionName",void 0),l([p({type:ps,json:{write:!0,name:"rasterFunctionArguments"}})],D.prototype,"functionArguments",void 0),l([p()],D.prototype,"rasterArgumentNames",void 0),l([p({json:{write:!0}})],D.prototype,"lookup",void 0),l([p({json:{write:!0}})],D.prototype,"cutOffs",void 0),D=l([x("esri.layers.support.rasterFunctions.StretchFunction")],D);const hs=D,S=new Map;function Es(t,n){if("rasterFunction"in t)return ne(t,n??{});throw new Ot("raster-function-helper","unsupported raster function json.")}function fs(t,n){return n[0]==="rasters"&&Array.isArray(t.rasters)?t.rasters:n.map(i=>t[i])}function ne(t,n){var m,v;const{rasterFunction:i,rasterFunctionArguments:a}=t,o=(m=t.outputPixelType)==null?void 0:m.toLowerCase();if(i==null||!S.has(i))throw new Ot("raster-function-helper",`unsupported raster function: ${i}`);const s=S.get(i),r=(typeof s.ctor=="function"?s.ctor:s.ctor.default).fromJSON({...t,outputPixelType:o}),{rasterArgumentNames:e}=r,u=[],c=fs(a,e),h=e[0]==="rasters",f=[];for(let w=0;w<c.length;w++){const A=c[w];let N;A==null||typeof A=="string"&&A.startsWith("$")?u.push(n==null?void 0:n.raster):typeof A=="string"?n[A]&&u.push(n[A]):typeof A!="number"&&"rasterFunction"in A&&(N=ne(A,n),h||(r.functionArguments[e[w]]=N),u.push(N)),h&&f.push(N??A)}if(h&&(r.functionArguments.rasters=f),n){r.sourceRasters=u;const w=(v=n.raster)==null?void 0:v.url;w&&(r.mainPrimaryRasterId=w)}return r}S.set("Aspect",{desc:"Aspect Function",ctor:ve,rasterArgumentNames:["raster"]}),S.set("BandArithmetic",{desc:"Band Arithmetic Function",ctor:Xe,rasterArgumentNames:["raster"]}),S.set("Colormap",{desc:"Colormap Function",ctor:Je,rasterArgumentNames:["raster"]}),S.set("CompositeBand",{desc:"CompositeBand Function",ctor:Ke,rasterArgumentNames:["rasters"]}),S.set("Convolution",{desc:"Convolution Function",ctor:rn,rasterArgumentNames:["raster"]}),S.set("ExtractBand",{desc:"ExtractBand Function",ctor:an,rasterArgumentNames:["raster"]}),S.set("Local",{desc:"Local Function",ctor:Qn,rasterArgumentNames:["rasters"]}),S.set("Mask",{desc:"Mask Function",ctor:ts,rasterArgumentNames:["raster"]}),S.set("NDVI",{desc:"NDVI Function",ctor:ns,rasterArgumentNames:["raster"]}),S.set("Remap",{desc:"Remap Function",ctor:rs,rasterArgumentNames:["raster"]}),S.set("Slope",{desc:"Slope Function",ctor:as,rasterArgumentNames:["raster"]}),S.set("StatisticsHistograms",{desc:"Statistics Histograms Function",ctor:ls,rasterArgumentNames:["raster"]}),S.set("Stretch",{desc:"Stretch Function",ctor:hs,rasterArgumentNames:["raster"]});let ot=class extends It{get affectsPixelSize(){return!1}forwardTransform(t){return t}inverseTransform(t){return t}};l([p()],ot.prototype,"affectsPixelSize",null),l([p({json:{write:!0}})],ot.prototype,"spatialReference",void 0),ot=l([x("esri.layers.support.rasterTransforms.BaseRasterTransform")],ot);const Pt=ot;let it=class extends Pt{constructor(){super(...arguments),this.type="gcs-shift",this.tolerance=1e-8}forwardTransform(n){return(n=n.clone()).type==="point"?(n.x>180+this.tolerance&&(n.x-=360),n):(n.xmin>=180-this.tolerance?(n.xmax-=360,n.xmin-=360):n.xmax>180+this.tolerance&&(n.xmin=-180,n.xmax=180),n)}inverseTransform(n){return(n=n.clone()).type==="point"?(n.x<-this.tolerance&&(n.x+=360),n):(n.xmin<-this.tolerance&&(n.xmin+=360,n.xmax+=360),n)}};l([tt({GCSShiftXform:"gcs-shift"})],it.prototype,"type",void 0),l([p()],it.prototype,"tolerance",void 0),it=l([x("esri.layers.support.rasterTransforms.GCSShiftTransform")],it);const ms=it;let lt=class extends Pt{constructor(){super(...arguments),this.type="identity"}};l([tt({IdentityXform:"identity"})],lt.prototype,"type",void 0),lt=l([x("esri.layers.support.rasterTransforms.IdentityTransform")],lt);const ds=lt;function Rt(t,n,i){const{x:a,y:o}=n;if(i<2)return{x:t[0]+a*t[2]+o*t[4],y:t[1]+a*t[3]+o*t[5]};if(i===2){const m=a*a,v=o*o,w=a*o;return{x:t[0]+a*t[2]+o*t[4]+m*t[6]+w*t[8]+v*t[10],y:t[1]+a*t[3]+o*t[5]+m*t[7]+w*t[9]+v*t[11]}}const s=a*a,r=o*o,e=a*o,u=s*a,c=s*o,h=a*r,f=o*r;return{x:t[0]+a*t[2]+o*t[4]+s*t[6]+e*t[8]+r*t[10]+u*t[12]+c*t[14]+h*t[16]+f*t[18],y:t[1]+a*t[3]+o*t[5]+s*t[7]+e*t[9]+r*t[11]+u*t[13]+c*t[15]+h*t[17]+f*t[19]}}function _t(t,n,i){const{xmin:a,ymin:o,xmax:s,ymax:r,spatialReference:e}=n;let u=[];if(i<2)u.push({x:a,y:r}),u.push({x:s,y:r}),u.push({x:a,y:o}),u.push({x:s,y:o});else{let f=10;for(let m=0;m<f;m++)u.push({x:a,y:o+(r-o)*m/(f-1)}),u.push({x:s,y:o+(r-o)*m/(f-1)});f=8;for(let m=1;m<=f;m++)u.push({x:a+(s-a)*m/f,y:o}),u.push({x:a+(s-a)*m/f,y:r})}u=u.map(f=>Rt(t,f,i));const c=u.map(f=>f.x),h=u.map(f=>f.y);return new ue({xmin:Math.min.apply(null,c),xmax:Math.max.apply(null,c),ymin:Math.min.apply(null,h),ymax:Math.max.apply(null,h),spatialReference:e})}function gs(t){const[n,i,a,o,s,r]=t,e=a*r-s*o,u=s*o-a*r;return[(s*i-n*r)/e,(a*i-n*o)/u,r/e,o/u,-s/e,-a/u]}let P=class extends Pt{constructor(){super(...arguments),this.polynomialOrder=1,this.type="polynomial"}readForwardCoefficients(t,n){const{coeffX:i,coeffY:a}=n;if(!(i!=null&&i.length)||!(a!=null&&a.length)||i.length!==a.length)return null;const o=[];for(let s=0;s<i.length;s++)o.push(i[s]),o.push(a[s]);return o}writeForwardCoefficients(t,n,i){const a=[],o=[];for(let s=0;s<(t==null?void 0:t.length);s++)s%2==0?a.push(t[s]):o.push(t[s]);n.coeffX=a,n.coeffY=o}get inverseCoefficients(){let t=this._get("inverseCoefficients");const n=this._get("forwardCoefficients");return!t&&n&&this.polynomialOrder<2&&(t=gs(n)),t}set inverseCoefficients(t){this._set("inverseCoefficients",t)}readInverseCoefficients(t,n){const{inverseCoeffX:i,inverseCoeffY:a}=n;if(!(i!=null&&i.length)||!(a!=null&&a.length)||i.length!==a.length)return null;const o=[];for(let s=0;s<i.length;s++)o.push(i[s]),o.push(a[s]);return o}writeInverseCoefficients(t,n,i){const a=[],o=[];for(let s=0;s<(t==null?void 0:t.length);s++)s%2==0?a.push(t[s]):o.push(t[s]);n.inverseCoeffX=a,n.inverseCoeffY=o}get affectsPixelSize(){return this.polynomialOrder>0}forwardTransform(t){if(t.type==="point"){const n=Rt(this.forwardCoefficients,t,this.polynomialOrder);return new Mt({x:n.x,y:n.y,spatialReference:t.spatialReference})}return _t(this.forwardCoefficients,t,this.polynomialOrder)}inverseTransform(t){if(t.type==="point"){const n=Rt(this.inverseCoefficients,t,this.polynomialOrder);return new Mt({x:n.x,y:n.y,spatialReference:t.spatialReference})}return _t(this.inverseCoefficients,t,this.polynomialOrder)}};l([p({json:{write:!0}})],P.prototype,"polynomialOrder",void 0),l([p()],P.prototype,"forwardCoefficients",void 0),l([ft("forwardCoefficients",["coeffX","coeffY"])],P.prototype,"readForwardCoefficients",null),l([at("forwardCoefficients")],P.prototype,"writeForwardCoefficients",null),l([p({json:{write:!0}})],P.prototype,"inverseCoefficients",null),l([ft("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],P.prototype,"readInverseCoefficients",null),l([at("inverseCoefficients")],P.prototype,"writeInverseCoefficients",null),l([p()],P.prototype,"affectsPixelSize",null),l([tt({PolynomialXform:"polynomial"})],P.prototype,"type",void 0),P=l([x("esri.layers.support.rasterTransforms.PolynomialTransform")],P);const ys=P,se={GCSShiftXform:ms,IdentityXform:ds,PolynomialXform:ys},xs=Object.keys(se);function Gs(t){const n=t==null?void 0:t.type;return!t||xs.includes(n)}function Ls(t){if(!(t==null?void 0:t.type))return null;const i=se[t==null?void 0:t.type];if(i){const a=new i;return a.read(t),a}return null}export{ms as c,Gs as f,Ls as i,Es as l,ys as m};
