import{E as T,l as g,m as f,o as m}from"./vendor-445d19db.js";import{a as L}from"./lazyLayerLoader-97724470.js";import{selectLayerClassPath as G}from"./portalLayers-ccf5226f.js";import"./layersLoader-5af19aa2.js";import"./jsonContext-2a93191e.js";import"./portalItemUtils-459238ac.js";function M(e){return p(e,"notes")}function A(e){return p(e,"markup")}function v(e){return p(e,"route")}function p(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function w(e,r,a){if(!r)return;const t=[];for(const y of r){const i=B(y,a);y.layerType==="GroupLayer"?t.push(x(i,y,a)):t.push(i)}const n=await T(t);for(const y of n)!y.value||a.filter&&!a.filter(y.value)||e.add(y.value)}const b={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},W={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},F={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},C={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},O={ArcGISFeatureLayer:"FeatureLayer"},V={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function B(e,r){return h(await D(e,r),e,r)}async function h(e,r,a){const t=new e;return t.read(r,a.context),t.type==="group"&&I(r)&&await k(t,r,a.context),await g(t,a.context),t}async function D(e,r){const a=r.context,t=U(a);let n=e.layerType||e.type;!n&&r&&r.defaultLayerType&&(n=r.defaultLayerType);const y=t[n];let i=y?L[y]:L.UnknownLayer;if(d(e)){const s=a==null?void 0:a.portal;if(e.itemId){const o=new f({id:e.itemId,portal:s});await o.load();const c=(await G(o)).className||"UnknownLayer";i=L[c]}}else n==="ArcGISFeatureLayer"?M(e)||A(e)?i=L.MapNotesLayer:v(e)?i=L.RouteLayer:I(e)&&(i=L.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?i=L.WMTSLayer:n==="WFS"&&e.wfsInfo.version!=="2.0.0"&&(i=L.UnsupportedLayer);return i()}function I(e){var r,a;return e.layerType!=="ArcGISFeatureLayer"||d(e)?!1:(((a=(r=e.featureCollection)==null?void 0:r.layers)==null?void 0:a.length)??0)>1}function d(e){return e.type==="Feature Collection"}function U(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=F;break;case"ground":r=W;break;default:r=b}else switch(e.layerContainerType){case"basemap":r=V;break;case"tables":r=O;break;default:r=C}return r}async function x(e,r,a){const t=new m,n=w(t,Array.isArray(r.layers)?r.layers:[],a),y=await e;if(await n,y.type==="group")return y.layers.addMany(t),y}async function k(e,r,a){const t=L.FeatureLayer,n=await t(),y=r.featureCollection,i=y.showLegend,s=y.layers.map((o,c)=>{var S;const l=new n;l.read(o,a);const u={...a,ignoreDefaults:!0};return l.read({id:`${e.id}-sublayer-${c}`,visibility:((S=r.visibleLayers)==null?void 0:S.includes(c))??!0},u),i!=null&&l.read({showLegend:i},u),l});e.layers.addMany(s)}export{w as populateOperationalLayers};
