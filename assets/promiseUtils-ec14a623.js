import"./string-cc430a78.js";import{a as T}from"./Error-8814705f.js";import{r as $,t as h,h as D,x as E}from"./typedArrayUtil-bd69bba0.js";function x(e){return{setTimeout:(r,t)=>{const n=e.setTimeout(r,t);return{remove:()=>e.clearTimeout(n)}}}}const C=x(globalThis);function g(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function U(e,r,t){if(!g(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(r,t);if(Array.isArray(r)){const n=r.slice();for(const o of n)e.addEventListener(o,t);return{remove(){for(const o of n)e.removeEventListener(o,t)}}}return e.addEventListener(r,t),{remove(){e.removeEventListener(r,t)}}}function j(e,r,t){if(!g(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(r,t);const n=U(e,r,o=>{n.remove(),t.call(e,o)});return{remove(){n.remove()}}}const k={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function z({key:e}){return k[e]||e}function a(e="Aborted"){return new T("AbortError",e)}function L(e,r="Aborted"){if(S(e))throw a(r)}function f(e){return $(e)?"aborted"in e?e:e.signal:e}function S(e){const r=f(e);return $(r)&&r.aborted}function B(e){if(v(e))throw e}function F(e){if(!v(e))throw e}function w(e,r){const t=f(e);if(!h(t)){if(!t.aborted)return j(t,"abort",()=>r());r()}}function G(e,r){const t=f(e);if(!h(t))return L(t),j(t,"abort",()=>r(a()))}function H(e,r){const t=f(r);return h(t)?e:new Promise((n,o)=>{let i=w(r,()=>o(a()));const s=()=>i=D(i);e.then(s,s),e.then(n,o)})}function v(e){return(e==null?void 0:e.name)==="AbortError"}async function I(e){try{return await e}catch(r){if(!v(r))throw r;return}}function y(){let e=null;const r=new Promise((t,n)=>{e={promise:void 0,resolve:t,reject:n}});return e.promise=r,e}async function P(e){if(!e)return;if(typeof e.forEach!="function"){const t=Object.keys(e),n=t.map(s=>e[s]),o=await P(n),i={};return t.map((s,c)=>i[s]=o[c]),i}const r=e;return new Promise(t=>{const n=[];let o=r.length;o===0&&t(n),r.forEach(i=>{const s={promise:i||Promise.resolve(i)};n.push(s),s.promise.then(c=>{s.value=c}).catch(c=>{s.error=c}).then(()=>{--o,o===0&&t(n)})})})}async function J(e){return(await P(e)).filter(r=>!!r.value).map(r=>r.value)}function M(e,r,t){const n=new AbortController;return w(t,()=>n.abort()),new Promise((o,i)=>{let s=setTimeout(()=>{s=0,o(r)},e);w(n,()=>{s&&(clearTimeout(s),i(a()))})})}function K(e,r,t,n){const o=t&&"abort"in t?t:null;n!=null||o||(n=t);let i=setTimeout(()=>{i=0,o&&o.abort()},r);const s=()=>n||new T("promiseUtils:timeout","The wrapped promise did not resolve within "+r+" ms");return e.then(c=>{if(i===0)throw s();return clearTimeout(i),c},c=>{throw clearTimeout(i),i===0?s():c})}function O(e){return e&&typeof e.then=="function"}function A(e){return O(e)?e:Promise.resolve(e)}function N(e,r=-1){let t,n,o,i,s=null;const c=(...l)=>{if(t){n=l,i&&i.reject(a()),i=y();const u=E(i.promise);if(s){const p=s;s=null,p.abort()}return u}if(o=i||y(),i=null,r>0){const u=new AbortController;t=A(e(...l,u.signal));const p=t;M(r).then(()=>{t===p&&(i?u.abort():s=u)})}else t=1,t=A(e(...l));const b=()=>{const u=n;n=o=t=s=null,u!=null&&c(...u)},d=t,m=o;return d.then(b,b),d.then(m.resolve,m.reject),E(m.promise)};return c}function Q(){let e,r;const t=new Promise((o,i)=>{e=o,r=i}),n=o=>{e(o)};return n.resolve=o=>e(o),n.reject=o=>r(o),n.timeout=(o,i)=>C.setTimeout(()=>n.reject(i),o),n.promise=t,n}async function V(e){await Promise.resolve(),L(e)}export{A as $,y as A,O as C,Q as D,P as E,J as L,V as O,M as U,a,F as b,G as d,g as e,L as f,I as g,z as i,v as j,K as k,S as p,U as r,C as t,w as v,B as w,N as x,H as y};
