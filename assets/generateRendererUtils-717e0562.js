import{e as v,y,n as z,l as I}from"./cast-4943406f.js";import{s as k}from"./jsonMap-9318d50f.js";import"./typedArrayUtil-bd69bba0.js";import"./ensureType-9613b5f0.js";import{m as D,p as B}from"./colorRamps-08b6e1ac.js";import{a as N}from"./Symbol-f543a02b.js";import{s as T}from"./Error-8814705f.js";const S=new k({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let x=class extends I{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};v([y({type:N,json:{write:!0}})],x.prototype,"baseSymbol",void 0),v([y({types:D,json:{read:{reader:B},write:!0}})],x.prototype,"colorRamp",void 0),v([y({json:{read:S.read,write:S.write}})],x.prototype,"type",void 0),x=v([z("esri.rest.support.ClassificationDefinition")],x);const E=x,$=new k({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),C=new k({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let V=class extends E{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(s){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",s)}set definedInterval(s){this.classificationMethod==="defined-interval"&&this._set("definedInterval",s)}};v([y({json:{write:!0}})],V.prototype,"breakCount",void 0),v([y({json:{write:!0}})],V.prototype,"classificationField",void 0),v([y({type:String,json:{read:$.read,write:$.write}})],V.prototype,"classificationMethod",void 0),v([y({json:{write:!0}})],V.prototype,"normalizationField",void 0),v([y({json:{read:C.read,write:C.write}})],V.prototype,"normalizationType",void 0),v([y({value:null,json:{write:!0}})],V.prototype,"standardDeviationInterval",null),v([y({value:null,json:{write:!0}})],V.prototype,"definedInterval",null),v([y()],V.prototype,"type",void 0),V=v([z("esri.rest.support.ClassBreaksDefinition")],V);const ee=V,L=T.getLogger("esri.rest.support.generateRendererUtils");function M(a,s){return Number(a.toFixed(s))}function te(a){const s=F(a),t=[],i=s.uniqueValues.length;for(let o=0;o<i;o++){const d=s.uniqueValues[o],c=s.valueFrequency[o],l=d.toString();t.push({value:d,count:c,label:l})}return{uniqueValues:t}}function ne(a){const{normalizationTotal:s}=a;return{classBreaks:R(a),normalizationTotal:s}}function R(a){const s=a.definition,{classificationMethod:t,breakCount:i,normalizationType:o,definedInterval:d}=s,c=[];let l=a.values;if(l.length===0)return[];l=l.sort((r,f)=>r-f);const p=l[0],m=l[l.length-1];if(t==="equal-interval")if(l.length>=i){const r=(m-p)/i;let f=p;for(let n=1;n<i;n++){const e=M(p+n*r,6);c.push({minValue:f,maxValue:e,label:b(f,e,o)}),f=e}c.push({minValue:f,maxValue:m,label:b(f,m,o)})}else l.forEach(r=>{c.push({minValue:r,maxValue:r,label:b(r,r,o)})});else if(t==="natural-breaks"){const r=F(l),f=a.valueFrequency||r.valueFrequency,n=_(r.uniqueValues,f,i);let e=p;for(let u=1;u<i;u++)if(r.uniqueValues.length>u){const h=M(r.uniqueValues[n[u]],6);c.push({minValue:e,maxValue:h,label:b(e,h,o)}),e=h}c.push({minValue:e,maxValue:m,label:b(e,m,o)})}else if(t==="quantile")if(l.length>=i&&p!==m){let r=p,f=Math.ceil(l.length/i),n=0;for(let e=1;e<i;e++){let u=f+n-1;u>l.length&&(u=l.length-1),u<0&&(u=0),c.push({minValue:r,maxValue:l[u],label:b(r,l[u],o)}),r=l[u],n+=f,f=Math.ceil((l.length-n)/(i-e))}c.push({minValue:r,maxValue:m,label:b(r,m,o)})}else{let r=-1;for(let f=0;f<l.length;f++){const n=l[f];n!==r&&(r=n,c.push({minValue:r,maxValue:n,label:b(r,n,o)}),r=n)}}else if(t==="standard-deviation"){const r=O(l),f=P(l,r);if(f===0)c.push({minValue:l[0],maxValue:l[0],label:b(l[0],l[0],o)});else{const n=A(p,m,i,r,f)*f;let e=0,u=p;for(let g=i;g>=1;g--){const w=M(r-(g-.5)*n,6);c.push({minValue:u,maxValue:w,label:b(u,w,o)}),u=w,e++}let h=M(r+.5*n,6);c.push({minValue:u,maxValue:h,label:b(u,h,o)}),u=h,e++;for(let g=1;g<=i;g++)h=e===2*i?m:M(r+(g+.5)*n,6),c.push({minValue:u,maxValue:h,label:b(u,h,o)}),u=h,e++}}else if(t==="defined-interval"){if(!d)return c;const r=l[0],f=l[l.length-1],n=Math.ceil((f-r)/d);let e=r;for(let u=1;u<n;u++){const h=M(r+u*d,6);c.push({minValue:e,maxValue:h,label:b(e,h,o)}),e=h}c.push({minValue:e,maxValue:f,label:b(e,f,o)})}return c}function b(a,s,t){let i=null;return i=a===s?t&&t==="percent-of-total"?a+"%":a.toString():t&&t==="percent-of-total"?a+"% - "+s+"%":a+" - "+s,i}function F(a){const s=[],t=[];let i=Number.MIN_VALUE,o=1,d=-1;for(let c=0;c<a.length;c++){const l=a[c];l===i?(o++,t[d]=o):l!==null&&(s.push(l),i=l,o=1,t.push(o),d++)}return{uniqueValues:s,valueFrequency:t}}function _(a,s,t){const i=a.length,o=[];t>i&&(t=i);for(let c=0;c<t;c++)o.push(Math.round(c*i/t-1));o.push(i-1);let d=j(o,a,s,t);return U(d.mean,d.sdcm,o,a,s,t)&&(d=j(o,a,s,t)),o}function j(a,s,t,i){let o=[],d=[],c=[],l=0;const p=[],m=[];for(let e=0;e<i;e++){const u=q(e,a,s,t);p.push(u.sbMean),m.push(u.sbSdcm),l+=m[e]}let r,f=l,n=!0;for(;n||l<f;){n=!1,o=[];for(let e=0;e<i;e++)o.push(a[e]);for(let e=0;e<i;e++)for(let u=a[e]+1;u<=a[e+1];u++)if(r=s[u],e>0&&u!==a[e+1]&&Math.abs(r-p[e])>Math.abs(r-p[e-1]))a[e]=u;else if(e<i-1&&a[e]!==u-1&&Math.abs(r-p[e])>Math.abs(r-p[e+1])){a[e+1]=u-1;break}f=l,l=0,d=[],c=[];for(let e=0;e<i;e++){d.push(p[e]),c.push(m[e]);const u=q(e,a,s,t);p[e]=u.sbMean,m[e]=u.sbSdcm,l+=m[e]}}if(l>f){for(let e=0;e<i;e++)a[e]=o[e],p[e]=d[e],m[e]=c[e];l=f}return{mean:p,sdcm:m}}function U(a,s,t,i,o,d){let c=0,l=0,p=0,m=0,r=!0;for(let f=0;f<2&&r;f++){f===0&&(r=!1);for(let n=0;n<d-1;n++)for(;t[n+1]+1!==t[n+2];){t[n+1]=t[n+1]+1;const e=q(n,t,i,o);p=e.sbMean,c=e.sbSdcm;const u=q(n+1,t,i,o);if(m=u.sbMean,l=u.sbSdcm,!(c+l<s[n]+s[n+1])){t[n+1]=t[n+1]-1;break}s[n]=c,s[n+1]=l,a[n]=p,a[n+1]=m,r=!0}for(let n=d-1;n>0;n--)for(;t[n]!==t[n-1]+1;){t[n]=t[n]-1;const e=q(n-1,t,i,o);p=e.sbMean,c=e.sbSdcm;const u=q(n,t,i,o);if(m=u.sbMean,l=u.sbSdcm,!(c+l<s[n-1]+s[n])){t[n]=t[n]+1;break}s[n-1]=c,s[n]=l,a[n-1]=p,a[n]=m,r=!0}}return r}function A(a,s,t,i,o){let d=Math.max(i-a,s-i)/o/t;return d=d>=1?1:d>=.5?.5:.25,d}function O(a){let s=0;for(let t=0;t<a.length;t++)s+=a[t];return s/=a.length,s}function P(a,s){let t=0;for(let i=0;i<a.length;i++){const o=a[i];t+=(o-s)*(o-s)}return t/=a.length,Math.sqrt(t)}function q(a,s,t,i){let o=0,d=0;for(let p=s[a]+1;p<=s[a+1];p++){const m=i[p];o+=t[p]*m,d+=m}d<=0&&L.warn("Exception in Natural Breaks calculation");const c=o/d;let l=0;for(let p=s[a]+1;p<=s[a+1];p++)l+=i[p]*(t[p]-c)**2;return{sbMean:c,sbSdcm:l}}export{ne as a,ee as l,E as m,te as n};
