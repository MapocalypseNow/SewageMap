import{eg as Fo,dS as Po,h as At}from"./vendor.f8a4aecc.js";import{i as Mt}from"./executionError.c4c51b90.js";function _o(l,s){const o=Rt[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Lo(l,s){const o=Rt[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}const Rt={min:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.min.apply(Math,l[0])},max:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.max.apply(Math,l[0])},avg:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Dt(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Mo(l[0])},stddev:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sqrt(St(l[0]))},count:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:St(l[0])}};function Dt(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s/l.length}function Mo(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s}function St(l){const s=Dt(l),o=l.length;let p=0;for(const i of l)p+=(i-s)**2;return o>1?p/(o-1):0}var P;(function(l){l.InvalidFunctionParameters="InvalidFunctionParameters",l.UnsupportedSqlFunction="UnsupportedSqlFunction",l.UnsupportedOperator="UnsupportedOperator",l.UnsupportedSyntax="UnsupportedSyntax",l.UnsupportedIsRhs="UnsupportedIsRhs",l.UnsupportedIsLhs="UnsupportedIsLhs",l.InvalidDataType="InvalidDataType",l.CannotCastValue="CannotCastValue",l.MissingStatisticParameters="MissingStatisticParameters"})(P||(P={}));const Ro={[P.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[P.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[P.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[P.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[P.UnsupportedOperator]:"Unsupported operator - {operator}",[P.UnsupportedSyntax]:"Unsupported syntax - {node}",[P.UnsupportedSqlFunction]:"Sql function not found = {function}",[P.InvalidDataType]:"Invalid sql data type",[P.CannotCastValue]:"Cannot cast value to the required data type"};class U extends Error{constructor(s,o){super(Mt(Ro[s],o)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,U)}}var R;(function(l){l.NeverReach="NeverReach",l.NotImplemented="NotImplemented",l.Cancelled="Cancelled",l.InvalidStatResponse="InvalidStatResponse",l.InvalidRequest="InvalidRequest",l.RequestFailed="RequestFailed",l.MissingFeatures="MissingFeatures",l.AggregationFieldNotFound="AggregationFieldNotFound",l.DataElementsNotFound="DataElementsNotFound"})(R||(R={}));const Do={[R.Cancelled]:"Cancelled",[R.InvalidStatResponse]:"Invalid statistics response from service",[R.InvalidRequest]:"Invalid request",[R.RequestFailed]:"Request failed - {reason}",[R.MissingFeatures]:"Missing features",[R.AggregationFieldNotFound]:"Aggregation field not found",[R.DataElementsNotFound]:"Data elements not found on service",[R.NeverReach]:"Encountered unreachable logic",[R.NotImplemented]:"Not implemented"};class Ot extends Error{constructor(s,o){super(Mt(Do[s],o)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,Ot)}}class E{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(s){if(s.precision!==null||s.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static _parseSecondsComponent(s,o){if(o.includes(".")){const p=o.split(".");s.second=parseFloat(p[0]),s.millis=parseInt(p[1],10)}else s.second=parseFloat(o)}static createFromMilliseconds(s){const o=new E;return o.second=s/1e3,o}static createFromValueAndQualifer(s,o,p){let i=null;const d=new E;if(d.op=p==="-"?"-":"+",o.type==="interval-period"){E._fixDefaults(o);const m=new RegExp("^[0-9]{1,}$");if(o.period==="year"||o.period==="month")throw new Error("Year-Month Intervals not supported");if(o.period==="second"){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(s))throw new Error("Illegal Interval");E._parseSecondsComponent(d,s)}else{if(!m.test(s))throw new Error("Illegal Interval");d[o.period]=parseFloat(s)}}else{if(E._fixDefaults(o.start),E._fixDefaults(o.end),o.start.period==="year"||o.start.period==="month")throw new Error("Year-Month Intervals not supported");if(o.end.period==="year"||o.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(o.start.period){case"day":switch(o.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d[o.start.period]=parseFloat(s.split(" ")[0]),d[o.end.period]=parseFloat(s.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),E._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(o.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d.hour=parseFloat(s.split(":")[0]),d.minute=parseFloat(s.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),E._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if(o.end.period!=="second")throw new Error("Invalid Interval.");if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.minute=parseFloat(m[0]),E._parseSecondsComponent(d,m[1])}break;default:throw new Error("Invalid Interval.")}}return d}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function Pe(l,s){const o=Jt[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Oo(l,s){const o=Jt[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}function Jo(l){return typeof l=="string"||l instanceof String}function $o(l){return l instanceof Date}function Et(l){const s=new Date(l.getTime());return s.setHours(0,0,0,0),s}function Ct(l,s){if($o(l))return s?Et(l):l;if(Jo(l)){const o=Po.fromSQL(l);if(o.isValid)return s?Et(o.toJSDate()):o.toJSDate()}throw new U(P.CannotCastValue)}const Jt={extract:{minParams:2,maxParams:2,evaluate:([l,s])=>{if(s==null)return null;if(s instanceof Date)switch(l.toUpperCase()){case"SECOND":return s.getSeconds();case"MINUTE":return s.getMinutes();case"HOUR":return s.getHours();case"DAY":return s.getDate();case"MONTH":return s.getMonth()+1;case"YEAR":return s.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:l=>{if(l.length===2){const[s,o]=l;return s==null||o==null?null:s.toString().substring(o-1)}if(l.length===3){const[s,o,p]=l;return s==null||o==null||p==null?null:p<=0?"":s.toString().substring(o-1,o+p-1)}}},position:{minParams:2,maxParams:2,evaluate:([l,s])=>l==null||s==null?null:s.indexOf(l)+1},trim:{minParams:2,maxParams:3,evaluate:l=>{const s=l.length===3,o=s?l[1]:" ",p=s?l[2]:l[1];if(o==null||p==null)return null;const i=`(${Fo(o)})`;switch(l[0]){case"BOTH":return p.replace(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return p.replace(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return p.replace(new RegExp(`${i}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.abs(l[0])},ceiling:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.ceil(l[0])},floor:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.floor(l[0])},log:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])},log10:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sin(l[0])},cos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cos(l[0])},tan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tan(l[0])},asin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.asin(l[0])},acos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.acos(l[0])},atan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.atan(l[0])},sign:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0]>0?1:l[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]**l[1]},mod:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]%l[1]},round:{minParams:1,maxParams:2,evaluate:l=>{const s=l[0],o=l.length===2?10**l[1]:1;return s==null?null:Math.round(s*o)/o}},truncate:{minParams:1,maxParams:2,evaluate:l=>l[0]==null?null:l.length===1?parseInt(l[0].toFixed(0),10):parseFloat(l[0].toFixed(l[1]))},char_length:{minParams:1,maxParams:1,evaluate:l=>typeof l[0]=="string"||l[0]instanceof String?l[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:l=>{let s="";for(let o=0;o<l.length;o++){if(l[o]==null)return null;s+=l[o].toString()}return s}},lower:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:l=>{for(const s of l)if(s!==null)return s;return null}},cosh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cosh(l[0])},sinh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sinh(l[0])},tanh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tanh(l[0])},nullif:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];return(s instanceof Date?s.valueOf():s)===(o instanceof Date?o.valueOf():o)?null:s}},cast:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];if(s===null)return null;switch(o.type){case"integer":{const p=parseInt(s,10);if(isNaN(p))throw new U(P.CannotCastValue);return p}case"smallint":{const p=parseInt(s,10);if(isNaN(p))throw new U(P.CannotCastValue);if(p>32767||p<-32767)throw new U(P.CannotCastValue);return p}case"float":case"real":{const p=parseFloat(s);if(isNaN(p))throw new U(P.CannotCastValue);return p}case"date":return Ct(s,!0);case"timestamp":return Ct(s,!1);case"varchar":{const p=s.toString();if(p.length>o.size)throw new U(P.CannotCastValue);return p}default:throw new U(P.InvalidDataType)}}}};var Ft,Pt,Ae={};Pt=function(){function l(i,d){function m(){this.constructor=i}m.prototype=d.prototype,i.prototype=new m}function s(i,d,m,t){var w=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(w,s.prototype),w.expected=d,w.found=m,w.location=t,w.name="SyntaxError",w}function o(i,d,m){return m=m||" ",i.length>d?i:(d-=i.length,i+(m+=m.repeat(d)).slice(0,d))}function p(i,d){var m,t={},w=(d=d!==void 0?d:{}).grammarSource,x={start:We},S=We,q="!",O="=",b=">=",C=">",M="<=",F="<>",jt="<",Le="!=",pe="+",fe="-",Me="||",zt="*",Gt="/",Wt="@",Re="'",De="N'",Z="''",Yt=".",Kt="null",Qt="true",Zt="false",Xt="in",en="is",tn="like",nn="escape",rn="not",an="and",sn="or",un="between",on="from",ln="for",cn="substring",pn="extract",fn="trim",dn="position",vn="timestamp",hn="date",mn="leading",gn="trailing",yn="both",wn="cast",Nn="as",In="integer",bn="smallint",Tn="float",xn="real",An="varchar",Sn="to",En="interval",Cn="year",Fn="month",Pn="day",_n="hour",Ln="minute",Mn="second",Rn="case",Dn="end",On="when",Jn="then",$n="else",Un=",",kn="(",qn=")",Oe="`",Vn=/^[A-Za-z_\x80-\uFFFF]/,Hn=/^[A-Za-z0-9_]/,Bn=/^[A-Za-z0-9_.\x80-\uFFFF]/,Je=/^[^']/,jn=/^[0-9]/,zn=/^[eE]/,Gn=/^[+\-]/,Wn=/^[ \t\n\r]/,$e=/^[^`]/,Yn=g("!",!1),Ue=g("=",!1),Kn=g(">=",!1),Qn=g(">",!1),Zn=g("<=",!1),Xn=g("<>",!1),er=g("<",!1),tr=g("!=",!1),de=g("+",!1),ve=g("-",!1),nr=g("||",!1),rr=g("*",!1),ar=g("/",!1),sr=J([["A","Z"],["a","z"],"_",["\x80","\uFFFF"]],!1,!1),ur=J([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),or=J([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uFFFF"]],!1,!1),ir=g("@",!1),ke=g("'",!1),lr=g("N'",!1),qe=g("''",!1),Ve=J(["'"],!0,!1),cr=g(".",!1),pr=J([["0","9"]],!1,!1),fr=J(["e","E"],!1,!1),dr=J(["+","-"],!1,!1),vr=g("NULL",!0),hr=g("TRUE",!0),mr=g("FALSE",!0),gr=g("IN",!0),yr=g("IS",!0),wr=g("LIKE",!0),Nr=g("ESCAPE",!0),Ir=g("NOT",!0),br=g("AND",!0),Tr=g("OR",!0),xr=g("BETWEEN",!0),Ar=g("FROM",!0),Sr=g("FOR",!0),Er=g("SUBSTRING",!0),Cr=g("EXTRACT",!0),Fr=g("TRIM",!0),Pr=g("POSITION",!0),_r=g("TIMESTAMP",!0),Lr=g("DATE",!0),Mr=g("LEADING",!0),Rr=g("TRAILING",!0),Dr=g("BOTH",!0),Or=g("CAST",!0),Jr=g("AS",!0),$r=g("INTEGER",!0),Ur=g("SMALLINT",!0),kr=g("FLOAT",!0),qr=g("REAL",!0),Vr=g("VARCHAR",!0),Hr=g("TO",!0),Br=g("INTERVAL",!0),jr=g("YEAR",!0),zr=g("MONTH",!0),Gr=g("DAY",!0),Wr=g("HOUR",!0),Yr=g("MINUTE",!0),Kr=g("SECOND",!0),Qr=g("CASE",!0),Zr=g("END",!0),Xr=g("WHEN",!0),ea=g("THEN",!0),ta=g("ELSE",!0),na=g(",",!1),ra=g("(",!1),aa=g(")",!1),sa=J([" ","	",`
`,"\r"],!1,!1),He=g("`",!1),Be=J(["`"],!0,!1),ua=function(e){return e},oa=function(e,r){var a={type:"expression-list"},u=Co(e,r);return a.value=u,a},ia=function(e,r){return K(e,r)},la=function(e,r){return K(e,r)},ca=function(e){return So("NOT",e)},pa=function(e,r){return r==""||r==null||r==null?e:r.type=="arithmetic"?K(e,r.tail):xt(r.op,e,r.right,r.escape)},fa=function(e){return{type:"arithmetic",tail:e}},da=function(e,r){return{op:e+"NOT",right:r}},va=function(e,r){return{op:e,right:r}},ha=function(e,r,a){return{op:"NOT"+e,right:{type:"expression-list",value:[r,a]}}},ma=function(e,r,a){return{op:e,right:{type:"expression-list",value:[r,a]}}},ga=function(e){return e[0]+" "+e[2]},ya=function(e){return e[0]+" "+e[2]},wa=function(e,r,a){return{op:e,right:r,escape:a.value}},Na=function(e,r){return{op:e,right:r,escape:""}},Ia=function(e,r){return{op:e,right:r}},ba=function(e){return{op:e,right:{type:"expression-list",value:[]}}},Ta=function(e,r){return{op:e,right:r}},xa=function(e,r){return K(e,r)},Aa=function(e,r){return K(e,r)},Sa=function(e){return e.paren=!0,e},Ea=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:e}},Ca=function(e){return e},Fa=function(e,r){return e+r.join("")},Pa=function(e,r){return e+r.join("")},_a=function(e){return{type:"parameter",value:e[1]}},La=function(e,r){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:e},r]}}},Ma=function(e,r,a){return{type:"function",name:"substring",args:{type:"expression-list",value:a?[e,r,a[2]]:[e,r]}}},Ra=function(e,r){return{type:"function",name:"cast",args:{type:"expression-list",value:[e,r]}}},Da=function(){return{type:"data-type",value:{type:"integer"}}},Oa=function(){return{type:"data-type",value:{type:"smallint"}}},Ja=function(){return{type:"data-type",value:{type:"float"}}},$a=function(){return{type:"data-type",value:{type:"real"}}},Ua=function(){return{type:"data-type",value:{type:"date"}}},ka=function(){return{type:"data-type",value:{type:"timestamp"}}},qa=function(e){return{type:"data-type",value:{type:"varchar",size:parseInt(e)}}},Va=function(e,r,a){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:e!=null?e:"BOTH"},r,a]}}},Ha=function(e,r){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:e!=null?e:"BOTH"},r]}}},Ba=function(e,r){return{type:"function",name:"position",args:{type:"expression-list",value:[e,r]}}},ja=function(e,r){return{type:"function",name:e,args:r||{type:"expression-list",value:[]}}},za=function(e){return{type:"timestamp",value:e.value}},Ga=function(e,r,a){return{type:"interval",value:r,qualifier:a,op:e}},Wa=function(e,r){return{type:"interval",value:e,qualifier:r,op:""}},Ya=function(e,r){return{type:"interval-qualifier",start:e,end:r}},Ka=function(e,r){return{type:"interval-period",period:e.value,precision:r,secondary:null}},Qa=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},Za=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},Xa=function(e,r){return{type:"interval-period",period:"second",precision:e,secondary:r}},es=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},ts=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},ns=function(e,r){return{type:"interval-period",period:e.value,precision:r,secondary:null}},rs=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},as=function(e,r){return{type:"interval-period",period:"second",precision:e,secondary:r}},ss=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},us=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},os=function(){return{type:"string",value:"day"}},is=function(){return{type:"string",value:"hour"}},ls=function(){return{type:"string",value:"minute"}},cs=function(){return{type:"string",value:"month"}},ps=function(){return{type:"string",value:"year"}},fs=function(e){return parseFloat(e)},ds=function(e){return parseFloat(e)},vs=function(e){return{type:"date",value:e.value}},hs=function(){return{type:"null",value:null}},ms=function(){return{type:"boolean",value:!0}},gs=function(){return{type:"boolean",value:!1}},je=function(){return"'"},ys=function(e){return{type:"string",value:e.join("")}},ws=function(e,r){return{type:"case-expression",format:"simple",operand:e,clauses:r,else:null}},Ns=function(e,r,a){return{type:"case-expression",format:"simple",operand:e,clauses:r,else:a.value}},Is=function(e){return{type:"case-expression",format:"searched",clauses:e,else:null}},bs=function(e,r){return{type:"case-expression",format:"searched",clauses:e,else:r.value}},Ts=function(e,r){return{type:"when-clause",operand:e,value:r}},xs=function(e,r){return{type:"when-clause",operand:e,value:r}},As=function(e){return{type:"else-clause",value:e}},Ss=function(e){return{type:"number",value:e}},Es=function(e,r,a){return parseFloat(e+r+a)},Cs=function(e,r){return parseFloat(e+r)},Fs=function(e,r){return parseFloat(e+r)},Ps=function(e){return parseFloat(e)},_s=function(e,r){return e[0]+r},Ls=function(e){return"."+(e!=null?e:"")},Ms=function(e,r){return e+r},Rs=function(e){return e.join("")},Ds=function(e,r){return"e"+(r===null?"":r)},Os=function(){return"IN"},Js=function(){return"IS"},$s=function(){return"LIKE"},Us=function(){return"ESCAPE"},ks=function(){return"NOT"},qs=function(){return"AND"},Vs=function(){return"OR"},Hs=function(){return"BETWEEN"},Bs=function(){return"FROM"},js=function(){return"FOR"},zs=function(){return"SUBSTRING"},Gs=function(){return"EXTRACT"},Ws=function(){return"TRIM"},Ys=function(){return"POSITION"},Ks=function(){return"TIMESTAMP"},Qs=function(){return"DATE"},Zs=function(){return"LEADING"},Xs=function(){return"TRAILING"},eu=function(){return"BOTH"},tu=function(){return"CAST"},nu=function(){return"AS"},ru=function(){return"INTEGER"},au=function(){return"SMALLINT"},su=function(){return"FLOAT"},uu=function(){return"REAL"},ou=function(){return"VARCHAR"},iu=function(){return"TO"},lu=function(){return"INTERVAL"},cu=function(){return"YEAR"},pu=function(){return"MONTH"},fu=function(){return"DAY"},du=function(){return"HOUR"},vu=function(){return"MINUTE"},hu=function(){return"SECOND"},mu=function(){return"CASE"},gu=function(){return"END"},yu=function(){return"WHEN"},wu=function(){return"THEN"},Nu=function(){return"ELSE"},Iu=function(e){return e},bu=function(e){return e.join("")},n=0,X=[{line:1,column:1}],D=0,he=[],c=0;if("startRule"in d){if(!(d.startRule in x))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');S=x[d.startRule]}function g(e,r){return{type:"literal",text:e,ignoreCase:r}}function J(e,r,a){return{type:"class",parts:e,inverted:r,ignoreCase:a}}function Tu(){return{type:"end"}}function ze(e){var r,a=X[e];if(a)return a;for(r=e-1;!X[r];)r--;for(a={line:(a=X[r]).line,column:a.column};r<e;)i.charCodeAt(r)===10?(a.line++,a.column=1):a.column++,r++;return X[e]=a,a}function Ge(e,r){var a=ze(e),u=ze(r);return{source:w,start:{offset:e,line:a.line,column:a.column},end:{offset:r,line:u.line,column:u.column}}}function v(e){n<D||(n>D&&(D=n,he=[]),he.push(e))}function xu(e,r,a){return new s(s.buildMessage(e,r),e,r,a)}function We(){var e,r;return e=n,f(),(r=A())!==t?(f(),e=ua(r)):(n=e,e=t),e}function Ye(){var e,r,a,u,h,N,I,T;if(e=n,(r=A())!==t){for(a=[],u=n,h=f(),(N=le())!==t?(I=f(),(T=A())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);u!==t;)a.push(u),u=n,h=f(),(N=le())!==t?(I=f(),(T=A())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);e=oa(r,a)}else n=e,e=t;return e}function A(){var e,r,a,u,h,N,I,T;if(e=n,(r=me())!==t){for(a=[],u=n,h=f(),(N=ct())!==t?(I=f(),(T=me())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);u!==t;)a.push(u),u=n,h=f(),(N=ct())!==t?(I=f(),(T=me())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);e=ia(r,a)}else n=e,e=t;return e}function me(){var e,r,a,u,h,N,I,T;if(e=n,(r=ee())!==t){for(a=[],u=n,h=f(),(N=ue())!==t?(I=f(),(T=ee())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);u!==t;)a.push(u),u=n,h=f(),(N=ue())!==t?(I=f(),(T=ee())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);e=la(r,a)}else n=e,e=t;return e}function ee(){var e,r,a,u,h;return e=n,(r=Y())===t&&(r=n,i.charCodeAt(n)===33?(a=q,n++):(a=t,c===0&&v(Yn)),a!==t?(u=n,c++,i.charCodeAt(n)===61?(h=O,n++):(h=t,c===0&&v(Ue)),c--,h===t?u=void 0:(n=u,u=t),u!==t?r=a=[a,u]:(n=r,r=t)):(n=r,r=t)),r!==t?(a=f(),(u=ee())!==t?e=ca(u):(n=e,e=t)):(n=e,e=t),e===t&&(e=Au()),e}function Au(){var e,r,a;return e=n,(r=$())!==t?(f(),(a=Su())===t&&(a=null),e=pa(r,a)):(n=e,e=t),e}function Su(){var e;return(e=Eu())===t&&(e=_u())===t&&(e=Fu())===t&&(e=Cu())===t&&(e=Pu()),e}function Eu(){var e,r,a,u,h,N;if(e=[],r=n,a=f(),(u=Ke())!==t?(h=f(),(N=$())!==t?r=a=[a,u,h,N]:(n=r,r=t)):(n=r,r=t),r!==t)for(;r!==t;)e.push(r),r=n,a=f(),(u=Ke())!==t?(h=f(),(N=$())!==t?r=a=[a,u,h,N]:(n=r,r=t)):(n=r,r=t);else e=t;return e!==t&&(e=fa(e)),e}function Ke(){var e;return i.substr(n,2)===b?(e=b,n+=2):(e=t,c===0&&v(Kn)),e===t&&(i.charCodeAt(n)===62?(e=C,n++):(e=t,c===0&&v(Qn)),e===t&&(i.substr(n,2)===M?(e=M,n+=2):(e=t,c===0&&v(Zn)),e===t&&(i.substr(n,2)===F?(e=F,n+=2):(e=t,c===0&&v(Xn)),e===t&&(i.charCodeAt(n)===60?(e=jt,n++):(e=t,c===0&&v(er)),e===t&&(i.charCodeAt(n)===61?(e=O,n++):(e=t,c===0&&v(Ue)),e===t&&(i.substr(n,2)===Le?(e=Le,n+=2):(e=t,c===0&&v(tr)))))))),e}function Cu(){var e,r,a,u;return e=n,(r=it())!==t?(f(),(a=Y())!==t?(f(),(u=$())!==t?e=da(r,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=it())!==t?(f(),(a=$())!==t?e=va(r,a):(n=e,e=t)):(n=e,e=t)),e}function Fu(){var e,r,a,u,h,N;return e=n,(r=Y())!==t?(f(),(a=pt())!==t?(f(),(u=$())!==t?(f(),(h=ue())!==t?(f(),(N=$())!==t?e=ha(a,u,N):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=pt())!==t?(f(),(a=$())!==t?(f(),(u=ue())!==t?(f(),(h=$())!==t?e=ma(r,a,h):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function Qe(){var e,r,a,u,h;return e=n,r=n,(a=Y())!==t?(u=f(),(h=lt())!==t?r=a=[a,u,h]:(n=r,r=t)):(n=r,r=t),r!==t&&(r=ga(r)),(e=r)===t&&(e=lt()),e}function ge(){var e,r,a,u,h;return e=n,r=n,(a=Y())!==t?(u=f(),(h=Te())!==t?r=a=[a,u,h]:(n=r,r=t)):(n=r,r=t),r!==t&&(r=ya(r)),(e=r)===t&&(e=Te()),e}function Pu(){var e,r,a,u;return e=n,(r=Qe())!==t?(f(),(a=G())!==t?(f(),oo()!==t?(f(),(u=be())!==t?e=wa(r,a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=Qe())!==t?(f(),(a=G())!==t?e=Na(r,a):(n=e,e=t)):(n=e,e=t)),e}function _u(){var e,r,a,u;return e=n,(r=ge())!==t?(f(),(a=_())!==t?(f(),(u=Ye())!==t?(f(),L()!==t?e=Ia(r,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=ge())!==t?(f(),(a=_())!==t?(f(),(u=L())!==t?e=ba(r):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=ge())!==t?(f(),(a=Ie())!==t?e=Ta(r,a):(n=e,e=t)):(n=e,e=t))),e}function $(){var e,r,a,u,h,N,I,T;if(e=n,(r=ye())!==t){for(a=[],u=n,h=f(),(N=Ze())!==t?(I=f(),(T=ye())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);u!==t;)a.push(u),u=n,h=f(),(N=Ze())!==t?(I=f(),(T=ye())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);e=xa(r,a)}else n=e,e=t;return e}function Ze(){var e;return i.charCodeAt(n)===43?(e=pe,n++):(e=t,c===0&&v(de)),e===t&&(i.charCodeAt(n)===45?(e=fe,n++):(e=t,c===0&&v(ve)),e===t&&(i.substr(n,2)===Me?(e=Me,n+=2):(e=t,c===0&&v(nr)))),e}function ye(){var e,r,a,u,h,N,I,T;if(e=n,(r=we())!==t){for(a=[],u=n,h=f(),(N=Xe())!==t?(I=f(),(T=we())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);u!==t;)a.push(u),u=n,h=f(),(N=Xe())!==t?(I=f(),(T=we())!==t?u=h=[h,N,I,T]:(n=u,u=t)):(n=u,u=t);e=Aa(r,a)}else n=e,e=t;return e}function Xe(){var e;return i.charCodeAt(n)===42?(e=zt,n++):(e=t,c===0&&v(rr)),e===t&&(i.charCodeAt(n)===47?(e=Gt,n++):(e=t,c===0&&v(ar))),e}function we(){var e,r;return(e=Hu())===t&&(e=Du())===t&&(e=Ou())===t&&(e=Uu())===t&&(e=ku())===t&&(e=Ju())===t&&(e=qu())===t&&(e=Zu())===t&&(e=Lu())===t&&(e=Ie())===t&&(e=n,_()!==t?(f(),(r=A())!==t?(f(),L()!==t?e=Sa(r):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function Lu(){var e;return(e=Mu())!==t&&(e=Ea(e)),e}function Mu(){var e;return(e=Ru())!==t&&(e=Ca(e)),e}function Ru(){var e,r,a,u;if(e=n,(r=Ne())!==t){for(a=[],u=tt();u!==t;)a.push(u),u=tt();e=Fa(r,a)}else n=e,e=t;return e}function et(){var e,r,a,u;if(e=n,(r=Ne())!==t){for(a=[],u=y();u!==t;)a.push(u),u=y();e=Pa(r,a)}else n=e,e=t;return e}function Ne(){var e;return Vn.test(i.charAt(n))?(e=i.charAt(n),n++):(e=t,c===0&&v(sr)),e}function y(){var e;return Hn.test(i.charAt(n))?(e=i.charAt(n),n++):(e=t,c===0&&v(ur)),e}function tt(){var e;return Bn.test(i.charAt(n))?(e=i.charAt(n),n++):(e=t,c===0&&v(or)),e}function Ie(){var e,r,a;return e=n,i.charCodeAt(n)===64?(r=Wt,n++):(r=t,c===0&&v(ir)),r!==t&&(a=et())!==t?e=r=[r,a]:(n=e,e=t),e!==t&&(e=_a(e)),e}function Du(){var e,r,a;return e=n,co()!==t?(f(),_()!==t?(f(),(r=Vu())!==t?(f(),xe()!==t?(f(),(a=A())!==t?(f(),L()!==t?e=La(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Ou(){var e,r,a,u,h,N,I;return e=n,lo()!==t?(f(),_()!==t?(f(),(r=A())!==t?(f(),xe()!==t?(f(),(a=A())!==t?(f(),u=n,(h=io())!==t?(N=f(),(I=A())!==t?u=h=[h,N,I,f()]:(n=u,u=t)):(n=u,u=t),u===t&&(u=null),(h=L())!==t?e=Ma(r,a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Ju(){var e,r,a;return e=n,mo()!==t?(f(),_()!==t?(f(),(r=A())!==t?(f(),go()!==t?(f(),(a=$u())!==t?(f(),L()!==t?e=Ra(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function $u(){var e,r,a;return e=n,(r=yo())!==t&&(r=Da()),(e=r)===t&&(e=n,(r=wo())!==t&&(r=Oa()),(e=r)===t&&(e=n,(r=No())!==t&&(r=Ja()),(e=r)===t&&(e=n,(r=Io())!==t&&(r=$a()),(e=r)===t&&(e=n,(r=vt())!==t&&(r=Ua()),(e=r)===t&&(e=n,(r=dt())!==t&&(r=ka()),(e=r)===t&&(e=n,(r=bo())!==t?(f(),_()!==t?(f(),(a=V())!==t?(f(),L()!==t?e=qa(a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t))))))),e}function Uu(){var e,r,a,u;return e=n,ft()!==t?(f(),_()!==t?(f(),(r=nt())===t&&(r=null),f(),(a=A())!==t?(f(),xe()!==t?(f(),(u=A())!==t?(f(),L()!==t?e=Va(r,a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,ft()!==t?(f(),_()!==t?(f(),(r=nt())===t&&(r=null),f(),(a=A())!==t?(f(),L()!==t?e=Ha(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function nt(){var e;return(e=fo())===t&&(e=vo())===t&&(e=ho()),e}function ku(){var e,r,a;return e=n,po()!==t?(f(),_()!==t?(f(),(r=A())!==t?(f(),Te()!==t?(f(),(a=A())!==t?(f(),L()!==t?e=Ba(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function qu(){var e,r,a;return e=n,(r=Ao())!==t?(f(),_()!==t?(f(),(a=Ye())===t&&(a=null),f(),L()!==t?e=ja(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function Vu(){var e;return(e=mt())===t&&(e=gt())===t&&(e=yt())===t&&(e=wt())===t&&(e=Nt())===t&&(e=H()),e}function Hu(){var e;return(e=be())===t&&(e=to())===t&&(e=Qu())===t&&(e=Ku())===t&&(e=Yu())===t&&(e=Bu())===t&&(e=ju()),e}function Bu(){var e,r;return e=n,dt()!==t?(f(),(r=G())!==t?e=za(r):(n=e,e=t)):(n=e,e=t),e}function ju(){var e,r,a,u;return e=n,ht()!==t?(f(),i.charCodeAt(n)===45?(r=fe,n++):(r=t,c===0&&v(ve)),r===t&&(i.charCodeAt(n)===43?(r=pe,n++):(r=t,c===0&&v(de))),r!==t?(f(),(a=G())!==t?(f(),(u=rt())!==t?e=Ga(r,a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,ht()!==t?(f(),(r=G())!==t?(f(),(a=rt())!==t?e=Wa(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)),e}function rt(){var e,r,a;return e=n,(r=zu())!==t?(f(),To()!==t?(f(),(a=Gu())!==t?e=Ya(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=Wu()),e}function zu(){var e,r,a;return e=n,(r=W())!==t?(f(),_()!==t?(f(),(a=ne())!==t?(f(),L()!==t?e=Ka(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=W())!==t&&(r=Qa(r)),e=r),e}function Gu(){var e,r,a,u;return e=n,(r=W())!==t&&(r=Za(r)),(e=r)===t&&(e=n,(r=H())!==t?(f(),_()!==t?(f(),(a=ne())!==t?(f(),le()!==t?(f(),(u=te())!==t?(f(),L()!==t?e=Xa(a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=H())!==t?(f(),_()!==t?(f(),(a=ne())!==t?(f(),L()!==t?e=es(a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=H())!==t&&(r=ts()),e=r))),e}function Wu(){var e,r,a,u;return e=n,(r=W())!==t?(f(),_()!==t?(f(),(a=te())!==t?(f(),L()!==t?e=ns(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=W())!==t&&(r=rs(r)),(e=r)===t&&(e=n,(r=H())!==t?(f(),_()!==t?(f(),(a=ne())!==t?(f(),le()!==t?(f(),(u=te())!==t?(f(),L()!==t?e=as(a,u):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=H())!==t?(f(),_()!==t?(f(),(a=te())!==t?(f(),L()!==t?e=ss(a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e===t&&(e=n,(r=H())!==t&&(r=us()),e=r)))),e}function W(){var e,r;return e=n,(r=yt())!==t&&(r=os()),(e=r)===t&&(e=n,(r=wt())!==t&&(r=is()),(e=r)===t&&(e=n,(r=Nt())!==t&&(r=ls()),(e=r)===t&&(e=n,(r=gt())!==t&&(r=cs()),(e=r)===t&&(e=n,(r=mt())!==t&&(r=ps()),e=r)))),e}function te(){var e;return(e=V())!==t&&(e=fs(e)),e}function ne(){var e;return(e=V())!==t&&(e=ds(e)),e}function Yu(){var e,r;return e=n,vt()!==t?(f(),(r=G())!==t?e=vs(r):(n=e,e=t)):(n=e,e=t),e}function Ku(){var e;return(e=ao())!==t&&(e=hs()),e}function Qu(){var e,r;return e=n,(r=so())!==t&&(r=ms()),(e=r)===t&&(e=n,(r=uo())!==t&&(r=gs()),e=r),e}function G(){var e;return(e=be())===t&&(e=Ie()),e}function be(){var e,r,a,u,h;if(e=n,i.charCodeAt(n)===39?(r=Re,n++):(r=t,c===0&&v(ke)),r===t&&(i.substr(n,2)===De?(r=De,n+=2):(r=t,c===0&&v(lr))),r!==t){for(a=[],u=n,i.substr(n,2)===Z?(h=Z,n+=2):(h=t,c===0&&v(qe)),h!==t&&(h=je()),(u=h)===t&&(Je.test(i.charAt(n))?(u=i.charAt(n),n++):(u=t,c===0&&v(Ve)));u!==t;)a.push(u),u=n,i.substr(n,2)===Z?(h=Z,n+=2):(h=t,c===0&&v(qe)),h!==t&&(h=je()),(u=h)===t&&(Je.test(i.charAt(n))?(u=i.charAt(n),n++):(u=t,c===0&&v(Ve)));i.charCodeAt(n)===39?(u=Re,n++):(u=t,c===0&&v(ke)),u!==t?e=ys(a):(n=e,e=t)}else n=e,e=t;return e}function Zu(){var e;return(e=Xu())===t&&(e=eo()),e}function Xu(){var e,r,a,u,h;if(e=n,oe()!==t)if(f(),(r=A())!==t){for(f(),a=[],u=ae();u!==t;)a.push(u),u=ae();u=f(),(h=ie())!==t?e=ws(r,a):(n=e,e=t)}else n=e,e=t;else n=e,e=t;if(e===t)if(e=n,oe()!==t)if(f(),(r=A())!==t){for(f(),a=[],u=ae();u!==t;)a.push(u),u=ae();u=f(),(h=at())!==t?(f(),ie()!==t?e=Ns(r,a,h):(n=e,e=t)):(n=e,e=t)}else n=e,e=t;else n=e,e=t;return e}function eo(){var e,r,a,u;if(e=n,oe()!==t){for(f(),r=[],a=re();a!==t;)r.push(a),a=re();a=f(),(u=ie())!==t?e=Is(r):(n=e,e=t)}else n=e,e=t;if(e===t)if(e=n,oe()!==t){for(f(),r=[],a=re();a!==t;)r.push(a),a=re();a=f(),(u=at())!==t?(f(),ie()!==t?e=bs(r,u):(n=e,e=t)):(n=e,e=t)}else n=e,e=t;return e}function re(){var e,r,a;return e=n,It()!==t?(f(),(r=A())!==t?(f(),bt()!==t?(f(),(a=A())!==t?e=Ts(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function ae(){var e,r,a;return e=n,It()!==t?(f(),(r=A())!==t?(f(),bt()!==t?(f(),(a=A())!==t?e=xs(r,a):(n=e,e=t)):(n=e,e=t)):(n=e,e=t)):(n=e,e=t),e}function at(){var e,r;return e=n,xo()!==t?(f(),(r=A())!==t?e=As(r):(n=e,e=t)):(n=e,e=t),e}function to(){var e,r,a,u;return e=n,(r=no())!==t?(a=n,c++,u=Ne(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Ss(r):(n=e,e=t)):(n=e,e=t),e}function no(){var e,r,a,u;return e=n,(r=se())!==t&&(a=st())!==t&&(u=ut())!==t?e=Es(r,a,u):(n=e,e=t),e===t&&(e=n,(r=se())!==t&&(a=st())!==t?e=Cs(r,a):(n=e,e=t),e===t&&(e=n,(r=se())!==t&&(a=ut())!==t?e=Fs(r,a):(n=e,e=t),e===t&&(e=n,(r=se())!==t&&(r=Ps(r)),e=r))),e}function se(){var e,r,a;return(e=V())===t&&(e=n,i.charCodeAt(n)===45?(r=fe,n++):(r=t,c===0&&v(ve)),r===t&&(i.charCodeAt(n)===43?(r=pe,n++):(r=t,c===0&&v(de))),r!==t&&(a=V())!==t?e=_s(r,a):(n=e,e=t)),e}function st(){var e,r,a;return e=n,i.charCodeAt(n)===46?(r=Yt,n++):(r=t,c===0&&v(cr)),r!==t?((a=V())===t&&(a=null),e=Ls(a)):(n=e,e=t),e}function ut(){var e,r,a;return e=n,(r=ro())!==t&&(a=V())!==t?e=Ms(r,a):(n=e,e=t),e}function V(){var e,r;if(e=[],(r=ot())!==t)for(;r!==t;)e.push(r),r=ot();else e=t;return e!==t&&(e=Rs(e)),e}function ot(){var e;return jn.test(i.charAt(n))?(e=i.charAt(n),n++):(e=t,c===0&&v(pr)),e}function ro(){var e,r,a;return e=n,zn.test(i.charAt(n))?(r=i.charAt(n),n++):(r=t,c===0&&v(fr)),r!==t?(Gn.test(i.charAt(n))?(a=i.charAt(n),n++):(a=t,c===0&&v(dr)),a===t&&(a=null),e=Ds(r,a)):(n=e,e=t),e}function ao(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===Kt?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(vr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=r=[r,a]:(n=e,e=t)):(n=e,e=t),e}function so(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===Qt?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(hr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=r=[r,a]:(n=e,e=t)):(n=e,e=t),e}function uo(){var e,r,a,u;return e=n,i.substr(n,5).toLowerCase()===Zt?(r=i.substr(n,5),n+=5):(r=t,c===0&&v(mr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=r=[r,a]:(n=e,e=t)):(n=e,e=t),e}function Te(){var e,r,a,u;return e=n,i.substr(n,2).toLowerCase()===Xt?(r=i.substr(n,2),n+=2):(r=t,c===0&&v(gr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Os():(n=e,e=t)):(n=e,e=t),e}function it(){var e,r,a,u;return e=n,i.substr(n,2).toLowerCase()===en?(r=i.substr(n,2),n+=2):(r=t,c===0&&v(yr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Js():(n=e,e=t)):(n=e,e=t),e}function lt(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===tn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(wr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=$s():(n=e,e=t)):(n=e,e=t),e}function oo(){var e,r,a,u;return e=n,i.substr(n,6).toLowerCase()===nn?(r=i.substr(n,6),n+=6):(r=t,c===0&&v(Nr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Us():(n=e,e=t)):(n=e,e=t),e}function Y(){var e,r,a,u;return e=n,i.substr(n,3).toLowerCase()===rn?(r=i.substr(n,3),n+=3):(r=t,c===0&&v(Ir)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=ks():(n=e,e=t)):(n=e,e=t),e}function ue(){var e,r,a,u;return e=n,i.substr(n,3).toLowerCase()===an?(r=i.substr(n,3),n+=3):(r=t,c===0&&v(br)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=qs():(n=e,e=t)):(n=e,e=t),e}function ct(){var e,r,a,u;return e=n,i.substr(n,2).toLowerCase()===sn?(r=i.substr(n,2),n+=2):(r=t,c===0&&v(Tr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Vs():(n=e,e=t)):(n=e,e=t),e}function pt(){var e,r,a,u;return e=n,i.substr(n,7).toLowerCase()===un?(r=i.substr(n,7),n+=7):(r=t,c===0&&v(xr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Hs():(n=e,e=t)):(n=e,e=t),e}function xe(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===on?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Ar)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Bs():(n=e,e=t)):(n=e,e=t),e}function io(){var e,r,a,u;return e=n,i.substr(n,3).toLowerCase()===ln?(r=i.substr(n,3),n+=3):(r=t,c===0&&v(Sr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=js():(n=e,e=t)):(n=e,e=t),e}function lo(){var e,r,a,u;return e=n,i.substr(n,9).toLowerCase()===cn?(r=i.substr(n,9),n+=9):(r=t,c===0&&v(Er)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=zs():(n=e,e=t)):(n=e,e=t),e}function co(){var e,r,a,u;return e=n,i.substr(n,7).toLowerCase()===pn?(r=i.substr(n,7),n+=7):(r=t,c===0&&v(Cr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Gs():(n=e,e=t)):(n=e,e=t),e}function ft(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===fn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Fr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Ws():(n=e,e=t)):(n=e,e=t),e}function po(){var e,r,a,u;return e=n,i.substr(n,8).toLowerCase()===dn?(r=i.substr(n,8),n+=8):(r=t,c===0&&v(Pr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Ys():(n=e,e=t)):(n=e,e=t),e}function dt(){var e,r,a,u;return e=n,i.substr(n,9).toLowerCase()===vn?(r=i.substr(n,9),n+=9):(r=t,c===0&&v(_r)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Ks():(n=e,e=t)):(n=e,e=t),e}function vt(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===hn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Lr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Qs():(n=e,e=t)):(n=e,e=t),e}function fo(){var e,r,a,u;return e=n,i.substr(n,7).toLowerCase()===mn?(r=i.substr(n,7),n+=7):(r=t,c===0&&v(Mr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Zs():(n=e,e=t)):(n=e,e=t),e}function vo(){var e,r,a,u;return e=n,i.substr(n,8).toLowerCase()===gn?(r=i.substr(n,8),n+=8):(r=t,c===0&&v(Rr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Xs():(n=e,e=t)):(n=e,e=t),e}function ho(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===yn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Dr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=eu():(n=e,e=t)):(n=e,e=t),e}function mo(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===wn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Or)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=tu():(n=e,e=t)):(n=e,e=t),e}function go(){var e,r,a,u;return e=n,i.substr(n,2).toLowerCase()===Nn?(r=i.substr(n,2),n+=2):(r=t,c===0&&v(Jr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=nu():(n=e,e=t)):(n=e,e=t),e}function yo(){var e,r,a,u;return e=n,i.substr(n,7).toLowerCase()===In?(r=i.substr(n,7),n+=7):(r=t,c===0&&v($r)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=ru():(n=e,e=t)):(n=e,e=t),e}function wo(){var e,r,a,u;return e=n,i.substr(n,8).toLowerCase()===bn?(r=i.substr(n,8),n+=8):(r=t,c===0&&v(Ur)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=au():(n=e,e=t)):(n=e,e=t),e}function No(){var e,r,a,u;return e=n,i.substr(n,5).toLowerCase()===Tn?(r=i.substr(n,5),n+=5):(r=t,c===0&&v(kr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=su():(n=e,e=t)):(n=e,e=t),e}function Io(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===xn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(qr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=uu():(n=e,e=t)):(n=e,e=t),e}function bo(){var e,r,a,u;return e=n,i.substr(n,7).toLowerCase()===An?(r=i.substr(n,7),n+=7):(r=t,c===0&&v(Vr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=ou():(n=e,e=t)):(n=e,e=t),e}function To(){var e,r,a,u;return e=n,i.substr(n,2).toLowerCase()===Sn?(r=i.substr(n,2),n+=2):(r=t,c===0&&v(Hr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=iu():(n=e,e=t)):(n=e,e=t),e}function ht(){var e,r,a,u;return e=n,i.substr(n,8).toLowerCase()===En?(r=i.substr(n,8),n+=8):(r=t,c===0&&v(Br)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=lu():(n=e,e=t)):(n=e,e=t),e}function mt(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===Cn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(jr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=cu():(n=e,e=t)):(n=e,e=t),e}function gt(){var e,r,a,u;return e=n,i.substr(n,5).toLowerCase()===Fn?(r=i.substr(n,5),n+=5):(r=t,c===0&&v(zr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=pu():(n=e,e=t)):(n=e,e=t),e}function yt(){var e,r,a,u;return e=n,i.substr(n,3).toLowerCase()===Pn?(r=i.substr(n,3),n+=3):(r=t,c===0&&v(Gr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=fu():(n=e,e=t)):(n=e,e=t),e}function wt(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===_n?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Wr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=du():(n=e,e=t)):(n=e,e=t),e}function Nt(){var e,r,a,u;return e=n,i.substr(n,6).toLowerCase()===Ln?(r=i.substr(n,6),n+=6):(r=t,c===0&&v(Yr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=vu():(n=e,e=t)):(n=e,e=t),e}function H(){var e,r,a,u;return e=n,i.substr(n,6).toLowerCase()===Mn?(r=i.substr(n,6),n+=6):(r=t,c===0&&v(Kr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=hu():(n=e,e=t)):(n=e,e=t),e}function oe(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===Rn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Qr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=mu():(n=e,e=t)):(n=e,e=t),e}function ie(){var e,r,a,u;return e=n,i.substr(n,3).toLowerCase()===Dn?(r=i.substr(n,3),n+=3):(r=t,c===0&&v(Zr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=gu():(n=e,e=t)):(n=e,e=t),e}function It(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===On?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(Xr)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=yu():(n=e,e=t)):(n=e,e=t),e}function bt(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===Jn?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(ea)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=wu():(n=e,e=t)):(n=e,e=t),e}function xo(){var e,r,a,u;return e=n,i.substr(n,4).toLowerCase()===$n?(r=i.substr(n,4),n+=4):(r=t,c===0&&v(ta)),r!==t?(a=n,c++,u=y(),c--,u===t?a=void 0:(n=a,a=t),a!==t?e=Nu():(n=e,e=t)):(n=e,e=t),e}function le(){var e;return i.charCodeAt(n)===44?(e=Un,n++):(e=t,c===0&&v(na)),e}function _(){var e;return i.charCodeAt(n)===40?(e=kn,n++):(e=t,c===0&&v(ra)),e}function L(){var e;return i.charCodeAt(n)===41?(e=qn,n++):(e=t,c===0&&v(aa)),e}function f(){var e,r;for(e=[],r=Tt();r!==t;)e.push(r),r=Tt();return e}function Tt(){var e;return Wn.test(i.charAt(n))?(e=i.charAt(n),n++):(e=t,c===0&&v(sa)),e}function Ao(){var e,r,a,u;if(e=n,(r=et())!==t&&(r=Iu(r)),(e=r)===t)if(e=n,i.charCodeAt(n)===96?(r=Oe,n++):(r=t,c===0&&v(He)),r!==t){if(a=[],$e.test(i.charAt(n))?(u=i.charAt(n),n++):(u=t,c===0&&v(Be)),u!==t)for(;u!==t;)a.push(u),$e.test(i.charAt(n))?(u=i.charAt(n),n++):(u=t,c===0&&v(Be));else a=t;a!==t?(i.charCodeAt(n)===96?(u=Oe,n++):(u=t,c===0&&v(He)),u!==t?e=bu(a):(n=e,e=t)):(n=e,e=t)}else n=e,e=t;return e}function So(e,r){return{type:"unary-expression",operator:e,expr:r}}function xt(e,r,a,u){var h={type:"binary-expression",operator:e,left:r,right:a};return u!==void 0&&(h.escape=u),h}function Eo(e,r){for(var a=[e],u=0;u<r.length;u++)a.push(r[u][3]);return a}function Co(e,r,a){return Eo(e,r)}function K(e,r){for(var a=e,u=0;u<r.length;u++)a=xt(r[u][1],a,r[u][3]);return a}if((m=S())!==t&&n===i.length)return m;throw m!==t&&n<i.length&&v(Tu()),xu(he,D<i.length?i.charAt(D):null,D<i.length?Ge(D,D+1):Ge(D,D))}return l(s,Error),s.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var m,t=null;for(m=0;m<i.length;m++)if(i[m].source===this.location.source){t=i[m].text.split(/\r\n|\n|\r/g);break}var w=this.location.start,x=this.location.source+":"+w.line+":"+w.column;if(t){var S=this.location.end,q=o("",w.line.toString().length," "),O=t[w.line-1],b=(w.line===S.line?S.column:O.length+1)-w.column||1;d+=`
 --> `+x+`
`+q+` |
`+w.line+" | "+O+`
`+q+" | "+o("",w.column-1," ")+o("",b,"^")}else d+=`
 at `+x}return d},s.buildMessage=function(i,d){var m={literal:function(b){return'"'+w(b.text)+'"'},class:function(b){var C=b.parts.map(function(M){return Array.isArray(M)?x(M[0])+"-"+x(M[1]):x(M)});return"["+(b.inverted?"^":"")+C.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(b){return b.description}};function t(b){return b.charCodeAt(0).toString(16).toUpperCase()}function w(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(C){return"\\x0"+t(C)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(C){return"\\x"+t(C)})}function x(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(C){return"\\x0"+t(C)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(C){return"\\x"+t(C)})}function S(b){return m[b.type](b)}function q(b){var C,M,F=b.map(S);if(F.sort(),F.length>0){for(C=1,M=1;C<F.length;C++)F[C-1]!==F[C]&&(F[M]=F[C],M++);F.length=M}switch(F.length){case 1:return F[0];case 2:return F[0]+" or "+F[1];default:return F.slice(0,-1).join(", ")+", or "+F[F.length-1]}}function O(b){return b?'"'+w(b)+'"':"end of input"}return"Expected "+q(i)+" but "+O(d)+" found."},{SyntaxError:s,parse:p}},(Ft={get exports(){return Ae},set exports(l){Ae=l}}).exports&&(Ft.exports=Pt());class Uo{static parse(s){return Ae.parse(s)}}const $t=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,ko=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,qo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,Vo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,Ho=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,Bo=new Set(["current_timestamp","current_date","current_time"]);function B(l,s){return(l+="").length>=s?l:new Array(s-l.length+1).join("0")+l}function Q(l,s,o="0",p="0",i="0",d="0",m="",t="0",w="0"){if(m==="+"||m==="-"){const x=`${B(parseInt(l,10),4)}-${B(parseInt(s,10),2)}-${B(parseInt(o,10),2)}`;let S="";parseFloat(d)<10&&(S="0");const q=`${B(parseInt(p,10),2)}:${B(parseInt(i,10),2)}:${S+parseFloat(d).toString()}`,O=`${m}${B(parseInt(t,10),2)}:${B(parseInt(w,10),2)}`;return new Date(x+"T"+q+O)}return new Date(parseInt(l,10),parseInt(s,10)-1,parseInt(o,10),parseInt(p,10),parseInt(i,10),parseFloat(d))}class jo{static makeBool(s){return Ut(s)}static featureValue(s,o,p,i){return Bt(s,o,p,i)}static equalsNull(s){return s===null}static applyLike(s,o,p){return Fe(s,o,p)}static ensureArray(s){return Ee(s)}static applyIn(s,o){return Ce(s,o)}static currentDate(){const s=new Date;return s.setHours(0,0,0,0),s}static makeSqlInterval(s,o,p){return E.createFromValueAndQualifer(s,o,p)}static convertInterval(s){return s instanceof E?s.valueInMilliseconds():s}static currentTimestamp(){return new Date}static compare(s,o,p){return Vt(s,o,p)}static calculate(s,o,p){return Ht(s,o,p)}static makeComparable(s){return k(s)}static evaluateFunction(s,o){return Pe(s,o)}static lookup(s,o){const p=o[s];return p===void 0?null:p}static between(s,o){return s==null||o[0]==null||o[1]==null?null:s>=o[0]&&s<=o[1]}static notbetween(s,o){return s==null||o[0]==null||o[1]==null?null:s<o[0]||s>o[1]}static ternaryNot(s){return ce(s)}static ternaryAnd(s,o){return kt(s,o)}static ternaryOr(s,o){return qt(s,o)}}class _e{constructor(s,o){this.fieldsIndex=o,this._datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=Uo.parse(s);const{isStandardized:p,isAggregate:i,referencedFieldNames:d}=this._extractExpressionInfo(o);this._referencedFieldNames=d,this.isStandardized=p,this.isAggregate=i}static create(s,o){return new _e(s,o)}get fieldNames(){return this._referencedFieldNames}testSet(s,o=j){const p={};for(const i of this.fieldNames)p[i]=s.map(d=>o.getAttribute(d,i));return!!this._evaluateNode(this.parseTree,{attributes:p},j)}calculateValue(s,o=j){const p=this._evaluateNode(this.parseTree,s,o);return p instanceof E?p.valueInMilliseconds()/864e5:p}calculateValueCompiled(s,o=j){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):At("esri-csp-restrictions")?this.calculateValue(s,o):(this._compileMe(),this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}testFeature(s,o=j){return!!this._evaluateNode(this.parseTree,s,o)}testFeatureCompiled(s,o=j){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):At("esri-csp-restrictions")?this.testFeature(s,o):(this._compileMe(),!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,s=>{s.type==="current-time"?this._hasDateFunctions=!0:s.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||Bo.has(s.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="function"&&s.add(o.name.toLowerCase())}),Array.from(s)}getExpressions(){const s=new Map;return this._visitAll(this.parseTree,o=>{if(o.type==="function"){const p=o.name.toLowerCase(),i=o.args.value[0];if(i.type==="column-reference"){const d=i.column,m=`${p}-${d}`;s.has(m)||s.set(m,{aggregateType:p,field:d})}}}),[...s.values()]}getVariables(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="parameter"&&s.add(o.value.toLowerCase())}),Array.from(s)}_compileMe(){const s="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",s).bind(jo)}_extractExpressionInfo(s){const o=[],p=new Set;let i=!0,d=!0;return this._visitAll(this.parseTree,m=>{var t;switch(m.type){case"column-reference":{const w=s==null?void 0:s.get(m.column);let x,S;w?x=S=(t=w.name)!=null?t:"":(S=m.column,x=S.toLowerCase()),w&&w.name&&(w.type==="date"||w.type==="esriFieldTypeDate")&&(this._datefields[w.name]=1),p.has(x)||(p.add(x),o.push(S)),m.column=S;break}case"function":{const{name:w,args:x}=m,S=x.value.length;i&&(i=Oo(w,S)),d&&(d=Lo(w,S));break}}}),{referencedFieldNames:Array.from(o),isStandardized:i,isAggregate:d}}_visitAll(s,o){if(s!=null)switch(o(s),s.type){case"when-clause":this._visitAll(s.operand,o),this._visitAll(s.value,o);break;case"case-expression":for(const p of s.clauses)this._visitAll(p,o);s.format==="simple"&&this._visitAll(s.operand,o),s.else!==null&&this._visitAll(s.else,o);break;case"expression-list":for(const p of s.value)this._visitAll(p,o);break;case"unary-expression":this._visitAll(s.expr,o);break;case"binary-expression":this._visitAll(s.left,o),this._visitAll(s.right,o);break;case"function":this._visitAll(s.args,o)}}evaluateNodeToJavaScript(s){switch(s.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(s.value)+", "+JSON.stringify(s.qualifier)+","+JSON.stringify(s.op)+")";case"case-expression":{let o="";if(s.format==="simple"){const p="this.makeComparable("+this.evaluateNodeToJavaScript(s.operand)+")";o="( ";for(let i=0;i<s.clauses.length;i++)o+=" ("+p+" === this.makeComparable("+this.evaluateNodeToJavaScript(s.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(s.clauses[i].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}else{o="( ";for(let p=0;p<s.clauses.length;p++)o+=" this.makeBool("+this.evaluateNodeToJavaScript(s.clauses[p].operand)+")===true ? ("+this.evaluateNodeToJavaScript(s.clauses[p].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}return o}case"parameter":return"this.lookup("+JSON.stringify(s.value.toLowerCase())+",lookups)";case"expression-list":{let o="[";for(const p of s.value)o!=="["&&(o+=","),o+=this.evaluateNodeToJavaScript(p);return o+="]",o}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(s.expr)+")";case"binary-expression":switch(s.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")";case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")"}throw new Error("Not Supported Operator "+s.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(s.value);case"date":return"(new Date("+_t(s.value).getTime().toString()+"))";case"timestamp":return"(new Date("+Se(s.value).getTime().toString()+"))";case"current-time":return s.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(s.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(s.name)+","+this.evaluateNodeToJavaScript(s.args)+")"}throw new Error("Unsupported sql syntax "+s.type)}_evaluateNode(s,o,p){switch(s.type){case"interval":{const i=this._evaluateNode(s.value,o,p);return E.createFromValueAndQualifer(i,s.qualifier,s.op)}case"case-expression":if(s.format==="simple"){const i=k(this._evaluateNode(s.operand,o,p));for(let d=0;d<s.clauses.length;d++)if(i===k(this._evaluateNode(s.clauses[d].operand,o,p)))return this._evaluateNode(s.clauses[d].value,o,p);if(s.else!==null)return this._evaluateNode(s.else,o,p)}else{for(let i=0;i<s.clauses.length;i++)if(Ut(this._evaluateNode(s.clauses[i].operand,o,p)))return this._evaluateNode(s.clauses[i].value,o,p);if(s.else!==null)return this._evaluateNode(s.else,o,p)}return null;case"parameter":return this.parameters[s.value.toLowerCase()];case"expression-list":{const i=[];for(const d of s.value)i.push(this._evaluateNode(d,o,p));return i}case"unary-expression":return ce(this._evaluateNode(s.expr,o,p));case"binary-expression":switch(s.operator){case"AND":return kt(this._evaluateNode(s.left,o,p),this._evaluateNode(s.right,o,p));case"OR":return qt(this._evaluateNode(s.left,o,p),this._evaluateNode(s.right,o,p));case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,p)===null;case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,p)!==null;case"IN":{const i=Ee(this._evaluateNode(s.right,o,p));return Ce(this._evaluateNode(s.left,o,p),i)}case"NOT IN":{const i=Ee(this._evaluateNode(s.right,o,p));return ce(Ce(this._evaluateNode(s.left,o,p),i))}case"BETWEEN":{const i=this._evaluateNode(s.left,o,p),d=this._evaluateNode(s.right,o,p);return i==null||d[0]==null||d[1]==null?null:i>=k(d[0])&&i<=k(d[1])}case"NOTBETWEEN":{const i=this._evaluateNode(s.left,o,p),d=this._evaluateNode(s.right,o,p);return i==null||d[0]==null||d[1]==null?null:i<k(d[0])||i>k(d[1])}case"LIKE":return Fe(this._evaluateNode(s.left,o,p),this._evaluateNode(s.right,o,p),s.escape);case"NOT LIKE":return ce(Fe(this._evaluateNode(s.left,o,p),this._evaluateNode(s.right,o,p),s.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Vt(s.operator,this._evaluateNode(s.left,o,p),this._evaluateNode(s.right,o,p));case"-":case"+":case"*":case"/":case"||":return Ht(s.operator,this._evaluateNode(s.left,o,p),this._evaluateNode(s.right,o,p))}case"null":case"boolean":case"string":case"number":return s.value;case"date":return _t(s.value);case"timestamp":return Se(s.value);case"current-time":{const i=new Date;return s.mode==="date"&&i.setHours(0,0,0,0),i}case"column-reference":return Bt(o,s.column,this._datefields,p);case"data-type":return s.value;case"function":{const i=this._evaluateNode(s.args,o,p);return this.isAggregate?_o(s.name,i):Pe(s.name,i)}}throw new Error("Unsupported sql syntax "+s.type)}}function Se(l){let s=ko.exec(l);if(s!==null){const[,o,p,i,d,m,t]=s;return Q(o,p,i,d,m,t)}if(s=qo.exec(l),s!==null){const[,o,p,i,d,m,t,w,x,S]=s;return Q(o,p,i,d,m,t,w,x,S)}if(s=Vo.exec(l),s!==null){const[,o,p,i,d,m,t,w,x]=s;return Q(o,p,i,d,m,"0",t,w,x)}if(s=Ho.exec(l),s!==null){const[,o,p,i,d,m]=s;return Q(o,p,i,d,m)}if(s=$t.exec(l),s!==null){const[,o,p,i]=s;return Q(o,p,i)}throw new Error("SQL Invalid Timestamp")}function _t(l){const s=$t.exec(l);if(s===null)try{return Se(l)}catch{throw new Error("SQL Invalid Date")}const[,o,p,i]=s;return new Date(parseInt(o,10),parseInt(p,10)-1,parseInt(i,10))}function Ut(l){return l===!0}function Ee(l){return Array.isArray(l)?l:[l]}function ce(l){return l!==null?l!==!0:null}function kt(l,s){return l!=null&&s!=null?l===!0&&s===!0:l!==!1&&s!==!1&&null}function qt(l,s){return l!=null&&s!=null?l===!0||s===!0:l===!0||s===!0||null}function Ce(l,s){if(l==null)return null;let o=!1;for(const p of s)if(p==null)o=null;else if(l===p){o=!0;break}return o}const Lt="-[]/{}()*+?.\\^$|";var z;function zo(l,s){const o=s;let p="",i=z.Normal;for(let d=0;d<l.length;d++){const m=l.charAt(d);switch(i){case z.Normal:m===o?i=z.Escaped:Lt.includes(m)?p+="\\"+m:p+=m==="%"?".*":m==="_"?".":m;break;case z.Escaped:Lt.includes(m)?p+="\\"+m:p+=m,i=z.Normal}}return new RegExp("^"+p+"$","m")}function Fe(l,s,o){return l==null?null:zo(s,o).test(l)}function k(l){return l instanceof Date?l.valueOf():l}function Vt(l,s,o){if(s==null||o==null)return null;const p=k(s),i=k(o);switch(l){case"<>":return p!==i;case"=":return p===i;case">":return p>i;case"<":return p<i;case">=":return p>=i;case"<=":return p<=i}}function Ht(l,s,o){if(l==="||")return Pe("concat",[s,o]);if(s instanceof E)if(o instanceof Date)switch(l){case"+":return new Date(s.valueInMilliseconds()+o.getTime());case"-":return s.valueInMilliseconds()-o.getTime();case"*":return s.valueInMilliseconds()*o.getTime();case"/":return s.valueInMilliseconds()/o.getTime()}else if(o instanceof E)switch(l){case"+":return E.createFromMilliseconds(s.valueInMilliseconds()+o.valueInMilliseconds());case"-":return E.createFromMilliseconds(s.valueInMilliseconds()-o.valueInMilliseconds());case"*":return s.valueInMilliseconds()*o.valueInMilliseconds();case"/":return s.valueInMilliseconds()/o.valueInMilliseconds()}else s=s.valueInMilliseconds();else if(o instanceof E)if(s instanceof Date)switch(l){case"+":return new Date(o.valueInMilliseconds()+s.getTime());case"-":return new Date(s.getTime()-o.valueInMilliseconds());case"*":return s.getTime()*o.valueInMilliseconds();case"/":return s.getTime()/o.valueInMilliseconds()}else o=o.valueInMilliseconds();else if(s instanceof Date&&typeof o=="number")switch(o=24*o*60*60*1e3,s=s.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}else if(o instanceof Date&&typeof s=="number")switch(s=24*s*60*60*1e3,o=o.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}switch(l){case"+":return s+o;case"-":return s-o;case"*":return s*o;case"/":return s/o}}function Go(l){return l&&typeof l.attributes=="object"}function Bt(l,s,o,p){const i=p.getAttribute(l,s);return i!=null&&o[s]===1?new Date(i):i}(function(l){l[l.Normal=0]="Normal",l[l.Escaped=1]="Escaped"})(z||(z={}));const j={getAttribute:(l,s)=>(Go(l)?l.attributes:l)[s]},Ko=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:_e,defaultAttributeAdapter:j},Symbol.toStringTag,{value:"Module"}));export{Ko as W,_e as f,R as n,Ot as o,U as s,P as t};
