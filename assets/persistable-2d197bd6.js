import{dJ as v,kd as P,ke as N,jD as O,ja as y,kf as R,kg as _,kh as S,ki as z,kj as h,kk as $,fS as F,dH as J,q as A,kl as B}from"./vendor-8855e047.js";import{i as D}from"./multiOriginJSONSupportUtils-c978f4c3.js";function f(e){return d[E(e)]||T}function E(e){return e instanceof Blob?e.type:K(e.url)}function K(e){const r=v(e);return g[r]||x}const d={},x="text/plain",T=d[x],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in g)d[g[e]]=e;function X(e){const r=(e==null?void 0:e.origins)??[void 0];return(o,s)=>{const n=V(e,o,s);for(const i of r){const a=P(o,i,s);for(const t in n)a[t]=n[t]}}}function V(e,r,o){if((e==null?void 0:e.type)==="resource")return q(e,r,o);switch((e==null?void 0:e.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:s,write:n}=B;return{read:s,write:n}}}}function q(e,r,o){const s=N(r,o);return{type:String,read:(n,i,a)=>{const t=O(n,i,a);return s.type===String?t:typeof s.type=="function"?new s.type({url:t}):void 0},write:{writer(n,i,a,t){if(!t||!t.resources)return typeof n=="string"?void(i[a]=y(n,t)):void(i[a]=n.write({},t));const l=C(n),p=y(l,{...t,verifyItemRelativeUrls:t&&t.verifyItemRelativeUrls?{writtenUrls:t.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},R.NO),u=s.type!==String&&(!D(this)||t&&t.origin&&this.originIdOf(o)>_(t.origin)),c={object:this,propertyName:o,value:n,targetUrl:p,dest:i,targetPropertyName:a,context:t,params:e};t&&t.portalItem&&p&&!S(p)?u?G(c):H(c):t&&t.portalItem&&(p==null||z(p)!=null||h(p)||u)?U(c):i[a]=p}}}}function U(e){const{targetUrl:r,params:o,value:s,context:n,dest:i,targetPropertyName:a}=e;if(!n.portalItem)return;const t=$(r),l=(t==null?void 0:t.filename)??F(),p=(o==null?void 0:o.prefix)??(t==null?void 0:t.prefix),u=I(s,r,n),c=J(p,l),j=`${c}.${f(u)}`,m=n.portalItem.resourceFromPath(j);h(r)&&n.resources&&n.resources.pendingOperations.push(L(r).then(k=>{m.path=`${c}.${f(k)}`,i[a]=m.itemRelativeUrl}).catch(()=>{}));const b=(o==null?void 0:o.compress)??!1;n.resources&&w({...e,resource:m,content:u,compress:b,updates:n.resources.toAdd}),i[a]=m.itemRelativeUrl}function G(e){const{context:r,targetUrl:o,params:s,value:n,dest:i,targetPropertyName:a}=e;if(!r.portalItem)return;const t=r.portalItem.resourceFromPath(o),l=I(n,o,r),p=f(l),u=v(t.path),c=(s==null?void 0:s.compress)??!1;p===u?(r.resources&&w({...e,resource:t,content:l,compress:c,updates:r.resources.toUpdate}),i[a]=o):U(e)}function H({context:e,targetUrl:r,dest:o,targetPropertyName:s}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),o[s]=r)}function w({object:e,propertyName:r,updates:o,resource:s,content:n,compress:i}){o.push({resource:s,content:n,compress:i,finish:a=>{M(e,r,a)}})}function I(e,r,o){return typeof e=="string"?{url:r}:new Blob([JSON.stringify(e.toJSON(o))],{type:"application/json"})}async function L(e){const r=(await A(()=>import("./vendor-8855e047.js").then(s=>s.m8),[])).default,{data:o}=await r(e,{responseType:"blob"});return o}function C(e){return e==null?null:typeof e=="string"?e:e.url}function M(e,r,o){typeof e[r]=="string"?e[r]=o.url:e[r].url=o.url}export{X as g};
