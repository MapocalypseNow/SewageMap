import{dI as v,kc as P,kd as N,jC as R,j9 as y,ke as O,kf as _,kg as z,kh as S,ki as h,kj as $,fR as F,dG as A,o as B,kk as E}from"./vendor-f61b19da.js";import{i as G}from"./multiOriginJSONSupportUtils-c978f4c3.js";function f(e){return d[J(e)]||T}function J(e){return e instanceof Blob?e.type:K(e.url)}function K(e){const r=v(e);return g[r]||x}const d={},x="text/plain",T=d[x],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in g)d[g[e]]=e;function X(e){const r=(e==null?void 0:e.origins)??[void 0];return(o,s)=>{const n=V(e,o,s);for(const i of r){const a=P(o,i,s);for(const t in n)a[t]=n[t]}}}function V(e,r,o){if((e==null?void 0:e.type)==="resource")return C(e,r,o);switch((e==null?void 0:e.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:s,write:n}=E;return{read:s,write:n}}}}function C(e,r,o){const s=N(r,o);return{type:String,read:(n,i,a)=>{const t=R(n,i,a);return s.type===String?t:typeof s.type=="function"?new s.type({url:t}):void 0},write:{writer(n,i,a,t){if(!t||!t.resources)return typeof n=="string"?void(i[a]=y(n,t)):void(i[a]=n.write({},t));const l=H(n),p=y(l,{...t,verifyItemRelativeUrls:t&&t.verifyItemRelativeUrls?{writtenUrls:t.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},O.NO),u=s.type!==String&&(!G(this)||t&&t.origin&&this.originIdOf(o)>_(t.origin)),c={object:this,propertyName:o,value:n,targetUrl:p,dest:i,targetPropertyName:a,context:t,params:e};t&&t.portalItem&&p&&!z(p)?u?D(c):L(c):t&&t.portalItem&&(p==null||S(p)!=null||h(p)||u)?I(c):i[a]=p}}}}function I(e){const{targetUrl:r,params:o,value:s,context:n,dest:i,targetPropertyName:a}=e;if(!n.portalItem)return;const t=$(r),l=(t==null?void 0:t.filename)??F(),p=(o==null?void 0:o.prefix)??(t==null?void 0:t.prefix),u=w(s,r,n),c=A(p,l),j=`${c}.${f(u)}`,m=n.portalItem.resourceFromPath(j);h(r)&&n.resources&&n.resources.pendingOperations.push(q(r).then(k=>{m.path=`${c}.${f(k)}`,i[a]=m.itemRelativeUrl}).catch(()=>{}));const b=(o==null?void 0:o.compress)??!1;n.resources&&U({...e,resource:m,content:u,compress:b,updates:n.resources.toAdd}),i[a]=m.itemRelativeUrl}function D(e){const{context:r,targetUrl:o,params:s,value:n,dest:i,targetPropertyName:a}=e;if(!r.portalItem)return;const t=r.portalItem.resourceFromPath(o),l=w(n,o,r),p=f(l),u=v(t.path),c=(s==null?void 0:s.compress)??!1;p===u?(r.resources&&U({...e,resource:t,content:l,compress:c,updates:r.resources.toUpdate}),i[a]=o):I(e)}function L({context:e,targetUrl:r,dest:o,targetPropertyName:s}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),o[s]=r)}function U({object:e,propertyName:r,updates:o,resource:s,content:n,compress:i}){o.push({resource:s,content:n,compress:i,finish:a=>{M(e,r,a)}})}function w(e,r,o){return typeof e=="string"?{url:r}:new Blob([JSON.stringify(e.toJSON(o))],{type:"application/json"})}async function q(e){const r=(await B(()=>import("./vendor-f61b19da.js").then(s=>s.m7),[])).default,{data:o}=await r(e,{responseType:"blob"});return o}function H(e){return e==null?null:typeof e=="string"?e:e.url}function M(e,r,o){typeof e[r]=="string"?e[r]=o.url:e[r].url=o.url}export{X as g};
