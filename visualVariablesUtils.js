import{t as h,cw as v,aq as z}from"./index.js";import{L as r,g}from"./color.js";import{A as S}from"./definitions.js";import{l as $}from"./visualVariablesUtils2.js";const E=8388607,m=8388608,x=254,V=255,F=0,y=1,d=s=>(s&m)>>>23,L=s=>s&E,U=s=>d(s)===y?x:V;function R(s){return d(s)===y}function T(s,t){return((t?m:0)|s)>>>0}const Z=(s,t)=>s&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),k=!1;function q(s,t){if(!s||!t)return s;switch(t){case"radius":case"distance":return 2*s;case"diameter":case"width":return s;case"area":return Math.sqrt(s)}return s}function _(s){return{value:s.value,size:v(s.size)}}function a(s){return(s!=null?s:[]).map(t=>_(t))}function c(s){if(typeof s=="string"||typeof s=="number")return v(s);const t=s;return{type:"size",expression:t.expression,stops:a(t.stops)}}const p=s=>{const t=[],e=[],n=a(s),o=n.length;for(let l=0;l<6;l++){const i=n[Math.min(l,o-1)];t.push(i.value),e.push(i.size==null?S:z(i.size))}return{values:new Float32Array(t),sizes:new Float32Array(e)}};function N(s){var n;const t=s&&s.length>0?{}:null,e=t?{}:null;if(!t||!e)return{vvFields:t,vvRanges:e};for(const o of s)if(o.field&&(t[o.type]=o.field),o.type==="size"){e.size||(e.size={});const l=o;switch($(l)){case r.SIZE_MINMAX_VALUE:e.size.minMaxValue={minDataValue:l.minDataValue,maxDataValue:l.maxDataValue,minSize:c(l.minSize),maxSize:c(l.maxSize)};break;case r.SIZE_SCALE_STOPS:e.size.scaleStops={stops:a(l.stops)};break;case r.SIZE_FIELD_STOPS:if(l.levels){const i={};for(const u in l.levels)i[u]=p(l.levels[u]);e.size.fieldStops={type:"level-dependent",levels:i}}else e.size.fieldStops={type:"static",...p(l.stops)};break;case r.SIZE_UNIT_VALUE:e.size.unitValue={unit:l.valueUnit,valueRepresentation:(n=l.valueRepresentation)!=null?n:void 0}}}else if(o.type==="color")e.color=A(o);else if(o.type==="opacity")e.opacity=w(o);else if(o.type==="rotation"){const l=o;e.rotation={type:l.rotationType}}return{vvFields:t,vvRanges:e}}function w(s){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(typeof s.field=="string"){if(!s.stops)return null;{if(s.stops.length>8)return null;const e=s.stops;for(let n=0;n<8;++n){const o=e[Math.min(n,e.length-1)];t.values[n]=o.value,t.opacities[n]=o.opacity}}}else{if(!(s.stops&&s.stops.length>=0))return null;{const e=s.stops&&s.stops.length>=0?s.stops[0].opacity:0;for(let n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=e}}return t}function f(s,t,e){s[4*t+0]=e.r/255,s[4*t+1]=e.g/255,s[4*t+2]=e.b/255,s[4*t+3]=e.a}function A(s){if(h(s)||s.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if(typeof s.field=="string"){if(!s.stops)return null;{if(s.stops.length>8)return null;t.field=s.field;const e=s.stops;for(let n=0;n<8;++n){const o=e[Math.min(n,e.length-1)];t.values[n]=o.value,f(t.colors,n,o.color)}}}else{if(!(s.stops&&s.stops.length>=0))return null;{const e=s.stops&&s.stops.length>=0&&s.stops[0].color;for(let n=0;n<8;n++)t.values[n]=1/0,f(t.colors,n,e)}}for(let e=0;e<32;e+=4)g(t.colors,e,!0);return t}export{E as a,N as b,y as c,d as e,L as f,U as i,k as l,Z as n,R as p,q as r,T as s,F as u};
